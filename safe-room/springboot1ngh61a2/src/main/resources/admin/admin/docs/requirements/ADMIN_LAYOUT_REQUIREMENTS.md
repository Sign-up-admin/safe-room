# 后台布局与导航需求文档（Admin Layout v1.0）

> 版本：v1.0
> 更新日期：2025-11-16
> 适用组件：`src/components/index/IndexMain.vue`、`IndexAsideStatic.vue`、`IndexHeader.vue`、`TagsView/index.vue`
> 覆盖区域：全局壳体（顶部、侧边栏、面包屑、内容区、标签页）

---

## 0. 设计关键词

结构清晰 · 快速定位 · 可折叠菜单 · 固定头部 · 多标签导航 · 响应式布局

---

## 1. 布局结构

```
.el-container.admin-layout
  ├─ IndexHeader（固定顶部）
  ├─ IndexAside（左侧导航，可折叠，支持垂直/水平布局）
  └─ el-main.admin-layout__content
      ├─ BreadCrumbs（面包屑导航）
      ├─ TagsView（多标签页导航）
      └─ RouterView（内容区，支持 keep-alive）
```

| 区域 | 功能 | 关键要求 |
| --- | --- | --- |
| 顶部 Header | 系统标题、用户信息、快捷入口 | 固定定位、支持下拉菜单 |
| 侧边栏 Aside | 菜单树、角色过滤、折叠状态 | 宽度 210px / 64px (折叠) |
| BreadCrumbs | 当前路径、导航回退 | 数据来自路由 meta |
| TagsView | 最近访问标签页，支持关闭/刷新/固定 | 最多 10 个标签，可滚动 |
| 内容区 | 渲染各业务页面 | 背景 `#F3F3F3`，内边距 20px |

---

## 2. 视觉规范

### 2.1 顶部
- 背景：`linear-gradient(180deg, rgba(255,255,255,1) 35%, rgba(230,230,230,1) 100%)`  
- 字体颜色：`#333`，辅助信息 `#999`  
- 阴影：`0 1px 4px rgba(15,27,55,0.08)`

### 2.2 侧边栏
- 展开宽度 210px，折叠宽度 64px  
- 背景：浅灰 `#F5F5F5`，边框 `1px solid rgba(0,0,0,0.06)`  
- 菜单项：
  - 默认状态：文字 14px，颜色 `#333`  
  - Hover：背景 `rgba(58,128,255,0.08)`  
  - Active：左侧 3px 指示条（亮蓝 `#3A80FF`），背景 `rgba(58,128,255,0.1)`

### 2.3 TagsView
- 背景 `#fff`，圆角 8px  
- 标签颜色：默认 `#606266`，激活 `#3A80FF`  
- 提供刷新、关闭当前、关闭其它、关闭全部菜单

---

## 3. 功能需求

### 3.1 菜单体系

| 能力 | 说明 |
| --- | --- |
| 数据来源 | `menu.ts/menu.js` + 接口返回，按角色过滤 |
| 权限控制 | `buttons` 字段标记可用操作；`menu` 字段用于显示文案 |
| 多级菜单 | 支持二级/三级；折叠时展示图标 Tooltip |
| 搜索 | 未来扩展：Ctrl+K 打开搜索面板，基于菜单树模糊匹配 |
| 高亮 | 根据当前路由自动高亮；路由别名需写入 `meta.activeMenu` |

### 3.2 侧边栏折叠

- 交互入口：Header 左侧折叠按钮
- 动画：平滑过渡动画，折叠时隐藏菜单文字，仅保留图标
- 本地持久化：`storage.set('asideCollapse', true/false)`，页面刷新后保持状态
- 响应式：移动端（<992px）自动折叠，桌面端恢复用户偏好设置
- 影响内容区：折叠时内容区宽度自动调整，保持布局流畅

### 3.3 标签页（TagsView）

| 功能 | 说明 |
| --- | --- |
| 添加标签 | 进入新路由时自动加入；`meta.affix=true` 的标签固定在最前（如首页） |
| 关闭标签 | 点击 × 关闭标签，右键菜单提供关闭选项；关闭当前标签自动跳转到相邻标签 |
| 关闭操作 | 支持关闭单个标签、关闭所有标签、关闭其他标签 |
| 刷新 | 右键菜单"刷新"选项，重新加载当前页面内容 |
| 滚动 | 标签超出容器宽度时自动出现滚动条，支持左右滚动查看 |
| 缓存管理 | 与 Vue 的 `keep-alive` 联动，关闭标签时自动清理对应的缓存组件 |
| 状态持久化 | 标签页状态在 Pinia store 中管理，支持页面刷新后恢复 |

### 3.4 面包屑

- 数据来自当前路由链（父 -> 子）  
- 最多 3 级，超过折叠为 `...`  
- 点击面包屑项跳转对应路由  
- 支持自定义标题 `meta.title`

### 3.5 顶部功能

- 用户信息下拉：个人中心、修改密码、退出登录  
- 消息提醒（可选）：红点提示未读，点击打开通知面板  
- 全局搜索（可选）：输入路由名称快速跳转

---

## 4. 交互与动效

| 场景 | 规范 |
| --- | --- |
| 菜单点击 | 高亮 + 滑动展开；子菜单折叠动画 ≤ 200ms |
| Header 固定 | 内容滚动时保持在顶部，避免抖动 |
| TagsView | 拖拽排序（可选）；关闭动画 120ms |
| 响应式 | 768px 以下自动折叠侧栏并显示 `drawer` 样式菜单 |

---

## 5. 状态管理

- **TagsView Store**：使用 Pinia `useTagsViewStore` 保存标签页状态，包括已访问标签、活跃标签等
- **Error Store**：使用 Pinia `useErrorStore` 管理全局错误状态
- **菜单数据**：`menu.ts` 配置数据缓存于本地，登录后根据角色过滤
- **折叠状态**：`isCollapse` 状态通过 Vue 响应式数据在组件间共享
- **本地存储**：侧边栏折叠状态持久化到 `storage`，支持页面刷新恢复

---

## 6. 可访问性

1. 侧边栏菜单支持键盘上下左右导航；Enter 触发点击  
2. TagsView 标签可通过 Tab 聚焦并使用 Delete 关闭  
3. Header 控件添加 `aria-label`（如“折叠菜单”）

---

## 7. 响应式策略

| 终端 | 处理 |
| --- | --- |
| ≥1440px | 固定布局，侧边栏展开宽度210px，内容区正常显示 |
| 1200-1439px | 菜单可折叠，内容区自适应宽度 |
| 992-1199px | 菜单默认折叠，内容区padding调整，表格支持横向滚动 |
| 768-991px | 移动端适配，侧边栏自动折叠，布局优化 |
| <768px | 极小屏幕适配，简化布局，标签页滚动优化，建议使用桌面端 |

---

## 8. 验收标准

| 维度 | 标准 |
| --- | --- |
| 导航准确性 | 菜单/面包屑/标签页高亮正确，路由跳转无误 |
| 可用性 | 侧边栏折叠状态持久化；标签页管理稳定；响应式布局适配良好 |
| 性能 | 路由切换无明显卡顿；布局重绘流畅；内存泄露控制 |
| 无障碍 | 支持键盘导航；焦点状态明显；屏幕阅读器兼容 |
| 兼容性 | 支持主流浏览器；移动端基本可用 |

---

## 9. 实现技术细节

### 9.1 核心组件架构

- **IndexMain.vue**：主布局容器，管理整体布局状态和响应式逻辑
- **IndexHeader.vue**：顶部导航栏，包含用户信息、折叠按钮、全局操作
- **IndexAsideStatic.vue**：侧边栏菜单，基于菜单配置动态渲染
- **TagsView/index.vue**：标签页组件，支持多标签管理、右键菜单、滚动
- **BreadCrumbs.vue**：面包屑导航，基于路由meta信息生成

### 9.2 状态管理实现

- **Pinia Store**：`useTagsViewStore` 管理标签页状态，`useErrorStore` 管理错误状态
- **本地存储**：使用自定义 `storage` 工具持久化用户偏好设置
- **响应式数据**：Vue 3 Composition API 管理组件间状态同步

### 9.3 路由集成

- **路由守卫**：基于Token验证和角色权限控制页面访问
- **动态菜单**：根据用户角色从 `menu.ts` 过滤可用菜单项
- **标签页联动**：路由变化自动更新标签页状态

## 10. 待办与扩展

- [ ] TagsView 支持拖拽排序功能
- [ ] 增加菜单搜索/快捷命令面板（Ctrl+K）
- [ ] TagsView 支持"收藏"功能，固定常用页面
- [ ] Header 增加夜间模式切换
- [ ] 优化移动端标签页交互体验

---***

