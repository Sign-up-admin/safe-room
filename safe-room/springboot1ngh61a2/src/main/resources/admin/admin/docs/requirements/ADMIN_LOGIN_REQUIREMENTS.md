# 后台登录页面需求文档（Admin Login v1.0）

> 版本：v1.0  
> 更新日期：2025-11-15（计划日期）  
> 适用路由：`/login`  
> 关联组件：`src/views/login.vue`

---

## 0. 设计关键词

可信赖 · 安全感 · 极简 · 低噪蓝调 · 快速进入

> 要求：登录体验 ≤ 15 秒，错误提示清晰，便于多角色切换。

---

## 1. 页面逻辑结构

| 顺序 | 区块 | 目的 |
| --- | --- | --- |
| ① | 左侧氛围/品牌信息（可选） | 强化品牌，展示产品价值 |
| ② | 登录卡片 | 输入账号/密码/角色，承载主要交互 |
| ③ | 底部辅助链接 | 找回密码、前往门户、技术支持 |

---

## 2. 视觉规范

### 2.1 背景
- 渐变背景：`linear-gradient(135deg, #091628, #101f3d)`  
- 支持粒子/微光动效，但默认关闭以保障性能

### 2.2 登录卡片
- 宽度：`min(520px, 100%)`，圆角 24px  
- 背景：`#FFFFFF`，阴影 `0 30px 80px rgba(10, 24, 64, 0.45)`  
- 标题区：`GYM ADMIN` 眉标，主标题 24px，加粗

### 2.3 表单元素
- 标签：上置，字重 500  
- 输入框：深色 placeholder，支持 `clearable`  
- 登录按钮：主色 `#3A80FF`，hover 明度 +8%，获取焦点时外环发光

---

## 3. 功能需求

| 功能 | 说明 | 接口/数据 | 边界场景 | 实现状态 |
| --- | --- | --- | --- | --- |
| 角色列表加载 | 根据 `menu.ts` 中 `hasBackLogin` 字段过滤 | 本地 `menu.ts` 配置 | 无可登录角色时提示"请联系管理员" | ✅ |
| 表单校验 | 账号/密码必填，角色>1时必选，包含安全验证 | 前端校验 + SQL注入/XSS检测 | 点击回车触发提交 | ✅ |
| 登录请求 | `POST /{tableName}/login`，参数通过URL传递 | `http.post` | 网络失败、密码错误、账户锁定 | ✅ |
| Token 存储 | 成功后使用 `secureStorage` 存储Token（1小时过期） | `tokenStorage.setToken()` | 支持"记住账号"选项 | ✅ |
| 错误反馈 | `ElMessage.error` 展示接口返回的 `msg` | - | 错误时显示友好提示信息 | ✅ |
| 跳转逻辑 | 登录成功跳转 `/`，支持 `redirect` 参数 | Vue Router | Token 过期时重定向回登录 | ✅ |
| 错误页面联动 | 从错误页跳转时，登录成功后返回原页面 | `router.query.redirect` | 验证路径安全性防止重定向攻击 | ✅ |
| 记住账号 | 支持记住账号功能，存储到localStorage | `storage` 工具 | 仅限个人设备使用 | ✅ |
| 输入安全 | SQL注入和XSS攻击检测 | `validator.ts` 工具 | 非法字符自动拦截 | ✅ |

---

## 4. 交互细节

| 交互点 | 规范 |
| --- | --- |
| 输入焦点 | 边框高亮 + 阴影 `0 0 0 4px rgba(58,128,255,0.16)` |
| 键盘操作 | `Enter` 提交；`Tab` 按顺序循环字段；支持 `Ctrl+Shift+←/→` 切换角色 |
| Loading | 登录按钮与表单整体 `v-loading`，禁止重复提交 |
| 错误提示 | 表单项下方红色提示，文本不超过 20 字 |
| 安全提示 | 页面底部显示“建议使用企业网络”“请勿在公共设备保存密码”等 |

---

## 5. 安全与合规

### 5.1 认证安全

- **HTTPS传输**：推荐在HTTPS环境下使用，确保账号密码传输安全
- **Token存储**：使用 `secureStorage` 安全存储Token，支持过期时间设置
- **密码安全**：前端不存储密码，密码字段在表单中隐藏
- **会话管理**：Token 1小时后自动过期，过期时清理本地存储

### 5.2 输入安全

- **SQL注入防护**：使用 `containsSqlInjection()` 函数检测并拦截SQL注入攻击
- **XSS防护**：使用 `containsXss()` 函数检测并拦截跨站脚本攻击
- **输入验证**：账号长度3-20字符，密码不能为空
- **数据规范化**：确保表单值始终为字符串类型，防止类型混淆攻击

### 5.3 访问控制

- **防重定向攻击**：登录成功后的跳转路径通过 `isValidInternalPath()` 验证
- **角色验证**：基于 `menu.ts` 配置的 `hasBackLogin` 字段控制登录权限
- **会话隔离**：不同角色的登录状态相互隔离

### 5.4 用户体验安全

- **记住账号提示**：显示"建议在个人设备上使用"的安全提示
- **公共设备警告**：页脚显示"请勿在公共设备保存密码"的安全提醒
- **错误信息安全**：避免泄露敏感信息，如"用户名不存在"等具体错误

---

## 6. 响应式策略

| 终端 | 处理 |
| --- | --- |
| PC (>992px) | 卡片居中，保留视觉氛围背景 |
| Pad (768-992px) | 调整卡片 padding 至 24px，字体 -2px |
| Mobile (<768px) | 背景换为纯色，按钮全宽，隐藏装饰元素；提供“返回前台”入口 |

---

## 7. 验收标准

| 维度 | 标准 | 实现状态 |
| --- | --- | --- |
| 功能完整性 | 正确加载角色，支持多角色登录流程 | ✅ |
| 性能表现 | 首屏渲染 ≤ 1s；接口成功后 300ms 内跳转 | ✅ |
| 安全合规 | Token 安全存储，输入验证有效，防注入攻击 | ✅ |
| 用户体验 | 支持键盘操作，错误提示友好，响应式适配 | ✅ |
| 无障碍访问 | 支持键盘导航，ARIA 标签完善 | ✅ |
| 数据安全 | 敏感信息不泄露，记住账号功能安全 | ✅ |

---

## 8. 与错误页面的联动

### 8.1 从错误页面跳转

当用户从 401/403 错误页面点击"前往登录"按钮时，登录页面应：

1. **接收 redirect 参数**：从 `router.query.redirect` 获取原页面路径
2. **登录成功后跳转**：优先跳转到 `redirect` 指定的页面，如无则跳转首页
3. **路径安全验证**：验证 `redirect` 路径是否为系统内路径，防止开放重定向漏洞

### 8.2 实现示例

```typescript
// 登录成功后
const redirect = router.currentRoute.value.query.redirect as string
if (redirect && isValidInternalPath(redirect)) {
  router.replace(redirect)
} else {
  router.replace('/')
}

function isValidInternalPath(path: string): boolean {
  // 验证路径是否为系统内路径，防止开放重定向
  return path.startsWith('/') && !path.startsWith('//') && !path.includes('http')
}
```

### 8.3 错误处理增强

- **网络错误**：显示友好提示，提供"重试"按钮
- **账户锁定**：超过 N 次失败后，显示账户锁定提示和联系管理员信息
- **Token 过期提示**：如从 401 错误页跳转，登录页可显示"您的登录已过期，请重新登录"提示

---

## 9. 待确认事项

- 是否需要短信/邮箱二次验证？  
- 是否支持单点登录（SSO）或与公司账号打通？  
- 记住密码策略是否允许？需产品决策。
- 登录失败次数限制和账户锁定策略的具体数值？

---

## 10. 参考文档

- [错误响应与非法访问拦截页面需求文档](./ERROR_PAGES_REQUIREMENTS.md)
- [安全文档](./SECURITY.md)

---***

