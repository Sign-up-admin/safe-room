# 配置管理模块需求文档（Config Management v1.0）

> 版本：v1.0
> 更新日期：2025-11-15（计划日期）
> 适用路由：`/config`
> 关联组件：`src/views/modules/config/list.vue`
> 继承组件：`ModuleCrudPage.vue`

---

## 0. 设计关键词

系统配置 · 轮播管理 · 参数设置 · 动态更新 · 配置缓存

---

## 1. 模块概述

配置管理模块负责管理系统全局配置、轮播图设置、参数配置等，为整个健身房管理系统的正常运行提供配置支撑。

### 1.1 业务价值

- **系统配置中心**：统一管理系统参数
- **界面个性化**：支持轮播图和主题配置
- **业务参数管理**：灵活调整业务规则参数
- **配置热更新**：支持配置实时生效

---

## 2. 功能需求

### 2.1 基础功能（继承 ModuleCrudPage）

- ✅ **配置列表**：展示所有配置项
- ✅ **配置搜索**：按配置名称、类型搜索
- ✅ **新增配置**：添加新的配置项
- ✅ **编辑配置**：修改配置值和说明
- ✅ **删除配置**：删除无效配置项
- ✅ **配置详情**：查看配置详细信息

### 2.2 配置类型支持

| 配置类型 | 说明 | 应用场景 | 组件类型 |
| --- | --- | --- | --- |
| 文本配置 | 单行文本输入 | 系统名称、联系方式等 | `el-input` |
| 富文本配置 | 多行文本/富文本 | 关于我们、服务条款等 | `RichTextEditor` |
| 图片配置 | 图片上传 | 轮播图、logo等 | `FileUpload` |
| 数值配置 | 数字输入 | 价格、数量限制等 | `el-input-number` |
| 选择配置 | 单选/多选 | 状态、类型选择等 | `el-select` |
| 开关配置 | 布尔值开关 | 功能开关、状态控制 | `el-switch` |

### 2.3 轮播图管理

| 功能 | 说明 | 业务规则 |
| --- | --- | --- |
| 图片上传 | 支持多张轮播图上传 | 文件大小≤5MB，格式jpg/png/webp |
| 排序调整 | 拖拽调整轮播顺序 | 数字越小越靠前显示 |
| 状态控制 | 启用/禁用轮播图 | 禁用的图不显示在前台 |
| 链接设置 | 设置点击跳转链接 | 支持内部路径和外部链接 |
| 标题设置 | 为轮播图设置标题和描述 | 用于SEO和可访问性 |

### 2.4 配置缓存管理

| 功能 | 说明 | 实现方式 |
| --- | --- | --- |
| 缓存更新 | 配置修改后更新缓存 | Redis/LocalStorage |
| 缓存清理 | 手动清理配置缓存 | 提供清理接口 |
| 缓存预热 | 系统启动时预加载配置 | 提高访问性能 |
| 缓存过期 | 配置缓存过期策略 | 默认5分钟过期 |

---

## 3. 数据字段定义

### 3.1 通用配置字段

| 字段名 | 类型 | 必填 | 说明 |
| --- | --- | --- | --- |
| `id` | number | 系统生成 | 配置项唯一标识 |
| `name` | text | ✅ | 配置项英文名称（用作key） |
| `value` | text/richtext/image | ✅ | 配置项值 |
| `type` | select | ✅ | 配置类型（text/richtext/image/number/select/switch） |
| `title` | text | ✅ | 配置项中文标题 |
| `description` | textarea | - | 配置项描述说明 |
| `category` | text | - | 配置分类（system/ui/business） |
| `is_required` | boolean | ✅ | 是否必填配置 |
| `sort` | number | - | 排序权重 |

### 3.2 轮播图专用字段

| 字段名 | 类型 | 必填 | 说明 |
| --- | --- | --- | --- |
| `image_url` | image | ✅ | 轮播图片URL |
| `title` | text | ✅ | 轮播图标题 |
| `description` | textarea | - | 轮播图描述 |
| `link_url` | text | - | 点击跳转链接 |
| `link_type` | select | - | 链接类型（internal/external/none） |
| `sort_order` | number | ✅ | 显示排序（数字越小越前） |
| `is_active` | boolean | ✅ | 是否启用显示 |

---

## 4. 配置分类管理

### 4.1 系统配置

| 配置项 | 默认值 | 说明 |
| --- | --- | --- |
| `system_name` | 健身房管理系统 | 系统名称 |
| `system_logo` | - | 系统logo图片 |
| `contact_phone` | - | 联系电话 |
| `contact_email` | - | 联系邮箱 |
| `business_hours` | 09:00-18:00 | 营业时间 |

### 4.2 界面配置

| 配置项 | 默认值 | 说明 |
| --- | --- | --- |
| `theme_color` | #3A80FF | 主色调 |
| `favicon` | - | 网站图标 |
| `homepage_banner` | - | 首页横幅 |
| `carousel_images` | [] | 轮播图片列表 |

### 4.3 业务配置

| 配置项 | 默认值 | 说明 |
| --- | --- | --- |
| `max_booking_per_day` | 5 | 每日最大预约数 |
| `advance_booking_days` | 30 | 预约提前天数 |
| `refund_deadline_hours` | 24 | 退款截止小时数 |
| `membership_expiry_reminder_days` | 7 | 会员到期提醒天数 |

---

## 5. 业务规则

### 5.1 配置验证规则

- **唯一性约束**：配置项name在同一分类下必须唯一
- **类型一致性**：配置值必须与配置类型匹配
- **必填验证**：必填配置项不能为空
- **格式验证**：邮箱、电话等特殊格式验证

### 5.2 轮播图规则

- **图片规格**：建议尺寸1920x600px，文件大小≤5MB
- **格式限制**：支持jpg、png、webp格式
- **数量限制**：最多支持10张轮播图
- **链接安全**：内部链接必须以系统路径开头

### 5.3 配置更新规则

- **热更新**：重要配置修改后立即生效
- **缓存刷新**：配置更新时清理相关缓存
- **日志记录**：记录所有配置变更操作
- **回滚支持**：支持配置变更回滚

---

## 6. 用户界面设计

### 6.1 配置列表页面

```
配置分类标签页：
├── 系统配置
├── 界面配置
└── 业务配置

配置列表：
├── 配置项名称 | 类型 | 值预览 | 操作
├── 系统名称   | 文本 | 健身房管理系统 | 编辑
├── 联系电话   | 文本 | 138****0000    | 编辑
└── 轮播图片   | 图片 | [缩略图]       | 编辑
```

### 6.2 配置编辑弹窗

```
配置编辑表单：
├── 配置名称：system_name (只读)
├── 配置标题：系统名称
├── 配置类型：文本
├── 配置值：[输入框/富文本/图片上传]
├── 配置描述：[文本域]
└── 是否必填：[开关]
```

### 6.3 轮播图管理界面

```
轮播图列表：
├── [拖拽手柄] [缩略图] 标题 | 链接 | 状态 | 操作
├── [≡] [img] 欢迎来到健身房 | / | 启用 | 编辑 删除
└── [≡] [img] 最新课程介绍 | /courses | 启用 | 编辑 删除

批量操作：
├── 批量启用 | 批量禁用 | 批量删除
└── 排序保存
```

---

## 7. 权限控制

| 权限 | 说明 | 适用角色 |
| --- | --- | --- |
| `config:list` | 查看配置列表 | 管理员 |
| `config:create` | 新增配置项 | 超级管理员 |
| `config:update` | 编辑配置项 | 管理员 |
| `config:delete` | 删除配置项 | 超级管理员 |
| `config:carousel` | 管理轮播图 | 管理员、前台 |
| `config:cache` | 管理配置缓存 | 管理员 |

---

## 8. 接口定义

### 8.1 基础 CRUD 接口

```typescript
GET    /config/page          // 分页列表
GET    /config/info/{id}     // 配置详情
POST   /config/save          // 新增配置
POST   /config/update        // 更新配置
POST   /config/delete        // 删除配置
```

### 8.2 业务接口

```typescript
GET    /config/get/{name}                // 根据名称获取配置
POST   /config/batch-update               // 批量更新配置
POST   /config/clear-cache                // 清理配置缓存
GET    /config/carousel/active            // 获取启用的轮播图
POST   /config/carousel/sort              // 更新轮播图排序
```

### 8.3 前端配置接口

```typescript
// 获取前端需要的配置
GET    /config/frontend

// 响应格式
{
  "system": {
    "name": "健身房管理系统",
    "logo": "/upload/logo.png"
  },
  "ui": {
    "themeColor": "#3A80FF",
    "carousel": [...]
  },
  "business": {
    "maxBookingPerDay": 5,
    "advanceBookingDays": 30
  }
}
```

---

## 9. 配置缓存策略

### 9.1 缓存层级

1. **应用层缓存**：内存缓存，进程重启时清除
2. **分布式缓存**：Redis缓存，多实例间共享
3. **浏览器缓存**：LocalStorage缓存，减少请求

### 9.2 缓存更新机制

- **主动更新**：配置修改时主动清理缓存
- **定时刷新**：定期检查配置是否有更新
- **懒加载**：配置首次访问时加载并缓存
- **缓存穿透保护**：防止大量并发请求穿透缓存

---

## 10. 验收标准

### 10.1 功能验收

| 验收项 | 标准 | 优先级 |
| --- | --- | --- |
| 基础CRUD | 配置项的增删改查功能正常 | 高 |
| 类型支持 | 支持所有配置类型和对应组件 | 高 |
| 轮播管理 | 轮播图上传、排序、启用禁用 | 高 |
| 缓存管理 | 配置缓存正确更新和清理 | 中 |
| 权限控制 | 不同角色配置权限正确隔离 | 高 |

### 10.2 性能验收

- **配置加载**：≤ 500ms（首次加载）
- **缓存命中**：≤ 50ms（缓存命中时）
- **轮播图加载**：≤ 2秒（包含图片加载）

### 10.3 用户体验验收

- **操作便捷性**：配置修改后实时生效
- **视觉反馈**：修改操作有明确提示
- **数据安全**：防止误删重要配置

---

## 11. 后续扩展

- [ ] **配置版本管理**：支持配置历史版本回溯
- [ ] **配置模板**：预设配置模板快速部署
- [ ] **多环境配置**：不同环境独立配置管理
- [ ] **配置审批流程**：重要配置修改需要审批
- [ ] **配置监控告警**：配置异常自动告警

---

## 12. 相关文档

- [通用CRUD需求文档](./ADMIN_MODULE_CRUD_REQUIREMENTS.md)
- [安全文档](./ADMIN_SECURITY_REQUIREMENTS.md)
- [缓存策略文档](./CACHE_STRATEGY.md)

---***
