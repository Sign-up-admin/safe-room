# Admin 前端技术文档

> 版本：v2.2.0
> 更新日期：2025-11-16
> 适用项目：`springboot1ngh61a2/src/main/resources/admin/admin`

---

## 目录

- [1. 项目概述](#1-项目概述)
- [2. 技术栈](#2-技术栈)
- [3. 项目结构](#3-项目结构)
- [4. 开发环境配置](#4-开发环境配置)
- [5. 核心功能模块](#5-核心功能模块)
- [6. 开发规范](#6-开发规范)
- [7. 构建与部署](#7-构建与部署)
- [8. 测试](#8-测试)
- [9. 常见问题](#9-常见问题)
- [10. 参考资料](#10-参考资料)

---

## 1. 项目概述

Admin 前端是健身房管理系统的后台管理界面，为管理员、运营人员和教练提供数据管理、内容配置、用户管理等功能。

### 1.1 主要特性

- ✅ **现代化技术栈**：Vue 3 + TypeScript + Vite
- ✅ **组件化开发**：基于 Element Plus 组件库
- ✅ **类型安全**：完整的 TypeScript 类型定义
- ✅ **状态管理**：Pinia 状态管理
- ✅ **路由管理**：Vue Router 4 路由守卫
- ✅ **安全机制**：Token 认证、CSRF 防护、安全存储
- ✅ **错误处理**：全局错误捕获和处理
- ✅ **代码质量**：ESLint、Prettier、Stylelint 代码规范
- ✅ **测试覆盖**：单元测试（Vitest）和端到端测试（Playwright）

### 1.2 设计原则

- **效率优先**：最少点击完成配置、审批、统计等任务
- **数据一目了然**：清晰的表格、图表展示
- **稳健权限**：完善的权限验证机制
- **浅色专业**：浅色主题，提升可读性和专业感
- **低噪动效**：适度的动画效果，不干扰操作
- **安全第一**：多层次安全防护，确保系统和数据安全
- **用户友好**：简化的密码重置流程，完善的错误提示

---

## 2. 技术栈

### 2.1 核心框架

| 技术 | 版本 | 说明 |
| --- | --- | --- |
| Vue | ^3.5.13 | 渐进式 JavaScript 框架，使用 Composition API |
| TypeScript | ~5.3.3 | 类型安全的 JavaScript 超集，全项目启用严格模式 |
| Vite | ^5.0.8 | 下一代前端构建工具，支持热更新和代码分割 |

### 2.2 UI 组件库

| 技术 | 版本 | 说明 |
| --- | --- | --- |
| Element Plus | ^2.8.8 | Vue 3 组件库，全量导入以确保一致性 |
| @element-plus/icons-vue | ^2.3.1 | Element Plus 图标库 |

### 2.3 状态管理与路由

| 技术 | 版本 | 说明 |
| --- | --- | --- |
| Pinia | ^2.2.6 | Vue 官方状态管理库 |
| Vue Router | ^4.5.0 | Vue 官方路由管理器 |

### 2.4 工具库

| 技术 | 版本 | 说明 |
| --- | --- | --- |
| Axios | ^1.7.9 | HTTP 客户端 |
| ECharts | ^5.4.3 | 数据可视化图表库 |
| echarts-wordcloud | ^2.1.0 | ECharts词云插件 |
| @vueup/vue-quill | ^1.2.0 | 富文本编辑器 |
| quill | ^1.3.7 | Quill富文本编辑器核心 |
| js-md5 | ^0.8.3 | MD5 加密 |
| DOMPurify | ^3.0.8 | HTML 净化工具 |
| @amap/amap-jsapi-loader | ^1.0.1 | 高德地图API加载器 |
| print-js | ^1.6.0 | 打印功能库 |
| crypto-js | ^4.2.0 | 加密算法库 |

#### 安全工具库

| 技术 | 说明 |
| --- | --- |
| secureStorage.ts | 安全存储工具（sessionStorage + Token管理） |
| rateLimiter.ts | 请求速率限制工具 |
| securityAudit.ts | 安全审计和事件记录工具 |
| validator.ts | 输入验证和安全检测工具 |
| SafeHtml.vue | 安全的HTML渲染组件（XSS防护） |
| csrf.ts | CSRF防护工具 |
| security.ts | 通用安全工具函数 |

### 2.5 开发工具

| 技术 | 版本 | 说明 |
| --- | --- | --- |
| ESLint | ^8.56.0 | JavaScript/TypeScript 代码检查 |
| @typescript-eslint/eslint-plugin | ^6.19.0 | TypeScript ESLint插件 |
| @typescript-eslint/parser | ^6.19.0 | TypeScript ESLint解析器 |
| eslint-config-prettier | ^9.1.0 | ESLint Prettier配置 |
| eslint-plugin-vue | ^9.32.0 | Vue ESLint插件 |
| Prettier | ^3.4.2 | 代码格式化工具 |
| Stylelint | ^16.9.1 | CSS/SCSS 代码检查 |
| stylelint-config-recess-order | ^5.1.1 | CSS属性排序配置 |
| stylelint-config-standard | ^36.0.1 | Stylelint标准配置 |
| stylelint-config-standard-scss | ^13.1.0 | SCSS标准配置 |
| Vitest | ^1.0.0 | 单元测试框架 |
| @vitest/ui | ^1.0.0 | Vitest UI界面 |
| @vitest/coverage-v8 | ^1.0.0 | Vitest覆盖率报告 |
| @vue/test-utils | ^2.4.3 | Vue测试工具 |
| jsdom | ^23.0.0 | DOM模拟环境 |
| happy-dom | ^12.0.0 | 轻量级DOM模拟环境 |
| Playwright | ^1.49.0 | 端到端测试框架 |

#### 测试覆盖率

- **测试文件总数**: 26个（新增6个）
- **测试用例总数**: 322个（新增约100+个）
- **通过率**: 291/322 (90.4%)
- **覆盖的核心模块**: 安全工具、错误处理、文件上传、验证器、组件等
| Husky | ^9.1.7 | Git hooks 工具 |
| lint-staged | ^15.2.11 | 暂存文件代码检查 |

### 2.6 构建工具插件

| 技术 | 版本 | 说明 |
| --- | --- | --- |
| @vitejs/plugin-vue | ^4.5.2 | Vite Vue 插件 |
| @vue/eslint-config-typescript | ^12.0.0 | Vue TypeScript ESLint配置 |
| @vue/tsconfig | ^0.5.1 | Vue TypeScript配置 |
| unplugin-auto-import | ^0.17.2 | 自动导入 API |
| unplugin-vue-components | ^0.25.2 | 自动导入组件 |
| vite-plugin-svg-icons | ^2.0.1 | SVG 图标插件 |
| axios-mock-adapter | ^2.1.0 | Axios请求模拟 |
| dotenv | ^16.4.5 | 环境变量加载 |
| postcss-html | ^1.8.0 | PostCSS HTML处理器 |
| sass | ^1.83.0 | Sass CSS预处理器 |
| typescript | ~5.3.3 | TypeScript编译器 |
| vue-tsc | ^1.8.25 | Vue TypeScript编译器 |

---

## 3. 项目结构

### 3.1 目录结构

```
admin/admin/
├── public/                 # 静态资源（不经过 Vite 处理）
│   ├── favicon.ico
│   ├── index.html
│   ├── lunar/             # 农历组件
│   └── verifys/           # 验证码组件
├── src/
│   ├── assets/            # 静态资源
│   │   ├── css/          # 样式文件（背景动效CSS）
│   │   ├── img/          # 图片资源
│   │   └── js/           # JavaScript 资源（背景动效JS）
│   ├── components/        # 组件库
│   │   ├── common/       # 通用组件（FileUpload, Editor等）
│   │   ├── echarts/      # 图表组件
│   │   ├── index/        # 布局组件（Header, Aside, Main等）
│   │   └── SvgIcon/      # SVG图标组件
│   ├── constants/         # 常量配置
│   │   ├── apiEndpoints.ts
│   │   ├── menu.ts       # 菜单权限配置
│   │   ├── sidebarStyles.d.ts
│   │   └── sidebarStyles.ts
│   ├── icons/             # 图标资源
│   │   ├── index.ts
│   │   └── svg/          # 159个SVG图标文件
│   ├── router/            # 路由配置
│   │   └── index.ts       # 路由定义和守卫
│   ├── stores/            # Pinia 状态管理
│   │   ├── error.ts      # 错误状态
│   │   ├── index.ts      # Store实例
│   │   └── tagsView.ts   # 标签页状态
│   ├── styles/            # 全局样式（27个SCSS文件）
│   │   ├── base/         # 基础样式
│   │   ├── components/   # 组件样式
│   │   ├── index.scss    # 主样式文件
│   │   ├── mixins/       # 样式混入
│   │   ├── tokens/       # 设计令牌
│   │   └── utilities/    # 工具样式
│   ├── types/             # TypeScript 类型定义
│   │   ├── api.ts        # API接口类型
│   │   ├── cryptojs.d.ts # 加密库类型
│   │   └── menu.ts       # 菜单类型
│   ├── utils/             # 工具函数（21个文件）
│   │   ├── api.ts        # API端点配置
│   │   ├── base.ts       # 基础配置
│   │   ├── csrf.ts       # CSRF防护
│   │   ├── des.ts        # DES加密
│   │   ├── errorHandler.ts # 错误处理
│   │   ├── fileUpload.ts # 文件上传工具
│   │   ├── http.ts       # HTTP客户端封装
│   │   ├── i18n.ts       # 国际化支持
│   │   ├── mask.ts       # 数据脱敏工具
│   │   ├── menu.ts       # 菜单工具函数
│   │   ├── particles.d.ts # 粒子效果类型定义
│   │   ├── particles.js  # 粒子效果脚本
│   │   ├── rateLimiter.ts # 请求限流器
│   │   ├── secureStorage.ts # 安全存储（Token加密）
│   │   ├── security.ts   # 安全工具
│   │   ├── securityAudit.ts # 安全审计
│   │   ├── storage.ts    # 本地存储封装
│   │   ├── utils.ts      # 通用工具函数
│   │   ├── validate.ts   # 表单验证
│   │   └── validator.ts  # 数据验证器
│   ├── views/             # 页面组件（35个文件）
│   │   ├── 404.vue       # 404错误页面
│   │   ├── board.vue     # 公告板页面
│   │   ├── center.vue    # 个人中心
│   │   ├── error/        # 错误页面目录
│   │   │   └── ErrorPage.vue # 通用错误页面
│   │   ├── home.vue      # 首页仪表盘
│   │   ├── index.vue     # 主布局容器
│   │   ├── login.vue     # 登录页面
│   │   ├── modules/      # 业务模块页面（24个模块）
│   │   │   ├── assets/         # 资产管理模块
│   │   │   ├── chat/           # 反馈管理模块
│   │   │   ├── components/     # 通用CRUD组件
│   │   │   ├── config/         # 轮播管理模块
│   │   │   ├── daoqitixing/    # 到期提醒模块
│   │   │   ├── discussjianshenkecheng/ # 课程评论模块
│   │   │   ├── huiyuanka/      # 会员卡管理模块
│   │   │   ├── huiyuankagoumai/ # 会员卡购买模块
│   │   │   ├── huiyuanxufei/   # 会员续费模块
│   │   │   ├── jianshenjiaolian/ # 健身教练模块
│   │   │   ├── jianshenkecheng/ # 健身课程模块
│   │   │   ├── jianshenqicai/  # 健身器材模块
│   │   │   ├── kechengleixing/ # 课程类型模块
│   │   │   ├── kechengtuike/   # 课程退课模块
│   │   │   ├── kechengyuyue/   # 课程预约模块
│   │   │   ├── legal-terms/    # 法律条款模块
│   │   │   ├── news/           # 公告管理模块
│   │   │   ├── newstype/       # 公告分类模块
│   │   │   ├── operation-log/  # 操作日志模块
│   │   │   ├── service-status/ # 服务状态模块
│   │   │   ├── sijiaoyuyue/    # 私教预约模块
│   │   │   ├── users/          # 管理员用户模块
│   │   │   ├── yonghu/         # 用户管理模块
│   │   │   └── ModulePlaceholder.vue # 模块占位符组件
│   │   ├── 404.vue             # 404页面
│   │   ├── board.vue           # 公告板
│   │   ├── center.vue          # 个人中心
│   │   ├── forgot-password.vue # 忘记密码
│   │   ├── home.vue            # 首页仪表盘
│   │   ├── index.vue           # 主布局容器
│   │   ├── login.vue           # 登录页面
│   │   ├── pay.vue             # 支付页面
│   │   ├── register.vue        # 注册页面
│   │   └── update-password.vue # 修改密码
│   ├── App.vue           # 根组件
│   ├── env.d.ts          # 环境类型定义
│   └── main.ts           # 入口文件
├── tests/                # 测试文件
│   ├── integration/      # 集成测试
│   ├── setup/           # 测试配置
│   └── unit/            # 单元测试
├── docs/                # 项目文档
├── index.html           # HTML 模板
├── package.json         # 项目配置
├── tsconfig.json        # TypeScript 配置
├── vite.config.ts       # Vite 配置
├── vitest.config.ts     # Vitest 配置
└── README.md            # 项目说明
```

### 3.2 核心文件说明

#### 3.2.1 入口文件 (`src/main.ts`)

应用入口文件，负责：
- 创建 Vue 应用实例
- 注册全局插件（Pinia、Router、Element Plus）
- 注册全局组件
- 配置全局属性
- 初始化错误处理器

#### 3.2.2 路由配置 (`src/router/index.ts`)

- 定义所有路由规则
- 配置路由懒加载
- 实现路由守卫（权限验证）
- Token 验证和重定向逻辑

#### 3.2.3 状态管理 (`src/stores/`)

使用 Pinia 进行状态管理：
- `index.ts`：Pinia 实例创建
- `tagsView.ts`：标签页视图状态
- `error.ts`：错误状态管理

#### 3.2.4 HTTP 请求 (`src/utils/http.ts`)

基于 Axios 的 HTTP 客户端：
- 请求/响应拦截器
- Token 自动注入
- CSRF 防护
- 错误重试机制
- 统一错误处理

#### 3.2.5 工具函数 (`src/utils/`)

| 文件 | 说明 |
| --- | --- |
| `storage.ts` | 本地存储封装（localStorage/sessionStorage） |
| `secureStorage.ts` | 安全存储（加密 Token） |
| `validate.ts` | 表单验证工具 |
| `api.ts` | API 端点定义 |
| `base.ts` | 基础配置 |
| `des.ts` | DES 加密解密 |
| `menu.ts` | 菜单工具函数 |
| `utils.ts` | 通用工具函数 |
| `errorHandler.ts` | 错误处理 |
| `csrf.ts` | CSRF 防护 |
| `security.ts` | 安全工具 |

---

## 4. 开发环境配置

### 4.1 环境要求

- **Node.js**：>= 16.0.0
- **npm**：>= 8.0.0 或 **yarn**：>= 1.22.0
- **Git**：>= 2.0.0

### 4.2 安装依赖

```bash
cd springboot1ngh61a2/src/main/resources/admin/admin
npm install
```

### 4.3 环境变量

项目使用环境变量进行配置，可通过 `.env` 文件设置：

```bash
# .env.development
VITE_API_BASE_URL=http://localhost:8080/springboot1ngh61a2
VITE_APP_TITLE=健身房管理系统
```

### 4.4 开发服务器

启动开发服务器：

```bash
npm run dev
```

开发服务器将在 `http://localhost:8081` 启动，支持：
- 热模块替换（HMR）
- 自动打开浏览器
- 代理配置（`/springboot1ngh61a2` → `http://localhost:8080/springboot1ngh61a2/`）

### 4.5 代码检查

```bash
# 检查代码规范
npm run check

# 自动修复代码规范问题
npm run check:fix

# 检查所有（包括样式）
npm run check:all

# 自动修复所有
npm run check:all:fix
```

### 4.6 类型检查

```bash
npm run type-check
```

---

## 5. 核心功能模块

### 5.1 认证模块

#### 5.1.1 登录 (`views/login.vue`)

- 用户名/密码登录
- Token 存储（安全存储）
- 登录状态持久化
- 自动重定向

#### 5.1.2 注册 (`views/register.vue`)

- 用户注册
- 表单验证
- 密码强度检查

#### 5.1.3 忘记密码 (`views/forgot-password.vue`)

- 密码重置申请
- 邮箱验证
- 重置链接发送
- 密码重置确认

#### 5.1.4 修改密码 (`views/update-password.vue`)

- 当前密码验证
- 新密码设置
- 密码强度检查
- 密码更新确认

#### 5.1.5 路由守卫

路由守卫实现权限验证：

```typescript
router.beforeEach((to, from, next) => {
  // 公开路由检查
  // Token 验证
  // 重定向逻辑
})
```

### 5.2 布局模块

#### 5.2.1 主布局 (`views/index.vue`)

包含：
- 顶部导航栏（`IndexHeader`）
- 侧边栏菜单（`IndexAside`）
- 主内容区（`IndexMain`）
- 标签页视图（`TagsView`）

#### 5.2.2 组件说明

| 组件 | 路径 | 说明 |
| --- | --- | --- |
| `IndexHeader` | `components/index/IndexHeader.vue` | 顶部导航栏 |
| `IndexAside` | `components/index/IndexAside.vue` | 侧边栏菜单 |
| `IndexMain` | `components/index/IndexMain.vue` | 主内容区 |
| `TagsView` | `components/index/TagsView/index.vue` | 标签页视图 |

### 5.3 安全模块

Admin前端实现了多层次的安全防护体系，涵盖存储安全、网络安全、输入验证、访问控制等各个方面。

#### 5.3.1 Token 安全存储

使用 sessionStorage 替代 localStorage，防止 XSS 攻击时 Token 泄露：

```typescript
import { tokenStorage } from '@/utils/secureStorage'

// 加密存储 Token（带过期时间）
const expiryTime = Date.now() + 60 * 60 * 1000 // 1小时
tokenStorage.setToken('jwt_token_here', expiryTime)

// 获取解密后的 Token（自动检查过期）
const token = tokenStorage.getToken()

// 清除 Token
tokenStorage.clearToken()
```

**安全特性：**
- 使用 sessionStorage，标签页关闭时自动清除
- 支持 Token 过期时间管理
- 向后兼容 localStorage 存储方式

#### 5.3.2 XSS 防护

修复所有 v-html 使用，统一使用 SafeHtml 组件：

```vue
<!-- 安全方式 -->
<template>
  <SafeHtml :html="content" />
</template>

<script setup>
import SafeHtml from '@/components/common/SafeHtml.vue'
</script>
```

**防护措施：**
- 使用 DOMPurify 清理 HTML 内容
- 限制允许的标签和属性
- 防止 XSS 攻击

#### 5.3.3 输入验证增强

登录页面输入验证包含安全检测：

```typescript
// 验证规则包含SQL注入和XSS检测
const rules = {
  username: [
    { required: true, message: '请输入账号' },
    {
      validator: (rule, value, callback) => {
        // 检测SQL注入和XSS攻击
        if (containsSqlInjection(value) || containsXss(value)) {
          callback(new Error('账号包含非法字符'))
          return
        }
        // 格式验证
        if (value.length < 3 || value.length > 20) {
          callback(new Error('账号长度应在3-20个字符之间'))
          return
        }
        callback()
      }
    }
  ]
}
```

#### 5.3.4 请求限流机制

防止暴力破解和恶意请求：

```typescript
import { rateLimiter } from '@/utils/rateLimiter'

// 登录速率限制（5次/15分钟）
if (!rateLimiter.isRateLimited('login_attempt', 5, 15 * 60 * 1000)) {
  const resetTime = rateLimiter.getResetTime('login_attempt')
  const minutes = resetTime ? Math.ceil((resetTime - Date.now()) / 60000) : 15
  throw new Error(`登录尝试次数过多，请${minutes}分钟后再试`)
}
```

#### 5.3.5 CSRF 防护

自动生成和验证 CSRF Token：

```typescript
import { getOrCreateCsrfToken, CSRF_TOKEN_HEADER } from '@/utils/csrf'

// 获取或创建 CSRF Token
const csrfToken = getOrCreateCsrfToken()

// 在请求头中添加 CSRF Token
headers[CSRF_TOKEN_HEADER] = csrfToken
```

#### 5.3.6 数据脱敏

敏感信息自动脱敏显示：

```typescript
import { mask } from '@/utils/mask'

// 手机号脱敏
mask.mobile('13800138000') // "138****8000"

// 身份证号脱敏
mask.idCard('110101199001011234') // "110101********1234"

// 姓名脱敏
mask.name('张三丰') // "张*丰"
```

#### 5.3.7 安全审计系统

记录所有敏感操作和安全事件：

```typescript
import { securityAuditor, SecurityEventType } from '@/utils/securityAudit'

// 记录登录事件
securityAuditor.logEvent(SecurityEventType.LOGIN_SUCCESS, {
  username: 'admin',
  ip: '192.168.1.1',
  userAgent: navigator.userAgent
})

// 记录速率限制触发
securityAuditor.logEvent(SecurityEventType.RATE_LIMIT_EXCEEDED, {
  action: 'login',
  identifier: 'admin',
  count: 5
})

// 记录XSS尝试
securityAuditor.logEvent(SecurityEventType.XSS_ATTEMPT, {
  input: '<script>alert(1)</script>',
  source: 'login_form'
})
```

**审计事件类型：**
- 登录成功/失败
- 速率限制触发
- XSS/SQL注入尝试
- 无效Token访问
- 权限变更
- 可疑活动

#### 5.3.8 HTTP 拦截器增强

请求级别的安全防护：

```typescript
// 请求拦截器 - 添加安全头
config.headers['X-Request-ID'] = generateRequestId()
config.headers['X-Request-Time'] = String(Date.now())
config.headers[CSRF_TOKEN_HEADER] = getOrCreateCsrfToken()

// 响应拦截器 - 401处理
if (response.status === 401) {
  tokenStorage.clearToken()
  storage.remove('Token')
  router.push('/login')
}
```

#### 5.3.9 路由守卫安全

增强的权限验证和安全重定向：

```typescript
router.beforeEach((to, from, next) => {
  // 公开路由检查（包含忘记密码页面）
  const publicRoutes = ['/login', '/register', '/forgot-password']

  if (publicRoutes.some(route => to.path.startsWith(route))) {
    // 验证重定向路径安全性，防止开放重定向漏洞
    if (to.query.redirect && !isValidInternalPath(to.query.redirect)) {
      next('/login')
      return
    }
    next()
    return
  }

  // Token验证（优先secureStorage，回退到localStorage）
  const token = tokenStorage.getToken() || storage.get('Token')
  if (!token) {
    tokenStorage.clearToken()
    storage.remove('Token')
    next({
      path: '/login',
      query: { redirect: to.fullPath }
    })
    return
  }

  next()
})
```

### 5.4 业务模块

#### 5.4.1 管理员模块列表

| 模块 | 路由 | 文件路径 | 权限说明 |
| --- | --- | --- | --- |
| 用户管理 | `/yonghu` | `views/modules/yonghu/list.vue` | 管理员专用 |
| 健身教练 | `/jianshenjiaolian` | `views/modules/jianshenjiaolian/list.vue` | 管理员专用 |
| 私教预约 | `/sijiaoyuyue` | `views/modules/sijiaoyuyue/list.vue` | 管理员专用 |
| 课程类型 | `/kechengleixing` | `views/modules/kechengleixing/list.vue` | 管理员专用 |
| 健身课程 | `/jianshenkecheng` | `views/modules/jianshenkecheng/list.vue` | 管理员专用 |
| 课程预约 | `/kechengyuyue` | `views/modules/kechengyuyue/list.vue` | 管理员专用 |
| 课程退课 | `/kechengtuike` | `views/modules/kechengtuike/list.vue` | 管理员专用 |
| 会员卡管理 | `/huiyuanka` | `views/modules/huiyuanka/list.vue` | 管理员专用 |
| 会员卡购买 | `/huiyuankagoumai` | `views/modules/huiyuankagoumai/list.vue` | 管理员专用 |
| 到期提醒 | `/daoqitixing` | `views/modules/daoqitixing/list.vue` | 管理员专用 |
| 会员续费 | `/huiyuanxufei` | `views/modules/huiyuanxufei/list.vue` | 管理员专用 |
| 健身器材 | `/jianshenqicai` | `views/modules/jianshenqicai/list.vue` | 管理员专用 |
| 轮播管理 | `/config` | `views/modules/config/list.vue` | 管理员专用 |
| 公告管理 | `/news` | `views/modules/news/list.vue` | 管理员专用 |
| 公告分类 | `/newstype` | `views/modules/newstype/list.vue` | 管理员专用 |
| 反馈管理 | `/chat` | `views/modules/chat/list.vue` | 管理员专用 |
| 资产管理 | `/assets` | `views/modules/assets/list.vue` | 管理员专用 |
| 管理员用户 | `/users` | `views/modules/users/list.vue` | 管理员专用 |
| 操作日志 | `/operation-log` | `views/modules/operation-log/list.vue` | 管理员专用 |
| 服务状态 | `/service-status` | `views/modules/service-status/list.vue` | 管理员专用 |
| 法律条款 | `/legal-terms` | `views/modules/legal-terms/list.vue` | 管理员专用 |
| 课程评论 | `/discussjianshenkecheng` | `views/modules/discussjianshenkecheng/list.vue` | 管理员专用 |

#### 5.4.2 用户模块列表

| 模块 | 路由 | 文件路径 | 权限说明 |
| --- | --- | --- | --- |
| 健身教练列表 | `/jianshenjiaolian` | `views/modules/jianshenjiaolian/list.vue` | 用户可用 |
| 健身课程列表 | `/jianshenkecheng` | `views/modules/jianshenkecheng/list.vue` | 用户可用 |
| 会员卡列表 | `/huiyuanka` | `views/modules/huiyuanka/list.vue` | 用户可用 |
| 健身器材列表 | `/jianshenqicai` | `views/modules/jianshenqicai/list.vue` | 用户可用 |

#### 5.4.3 教练模块列表

| 模块 | 路由 | 文件路径 | 权限说明 |
| --- | --- | --- | --- |
| 私教预约管理 | `/sijiaoyuyue` | `views/modules/sijiaoyuyue/list.vue` | 教练专用 |
| 健身课程管理 | `/jianshenkecheng` | `views/modules/jianshenkecheng/list.vue` | 教练专用 |
| 课程预约管理 | `/kechengyuyue` | `views/modules/kechengyuyue/list.vue` | 教练专用 |
| 课程退课管理 | `/kechengtuike` | `views/modules/kechengtuike/list.vue` | 教练专用 |

#### 5.4.2 通用 CRUD 组件

`ModuleCrudPage.vue` 提供通用的 CRUD 功能：
- 列表展示（支持排序、分页）
- 搜索过滤（关键词搜索、条件筛选）
- 新增/编辑/删除（表单验证、权限控制）
- 批量操作（批量删除、导出）
- 数据导出（Excel 格式）
- 权限控制（基于角色的按钮显示）

### 5.5 通用组件

#### 5.5.1 文件上传

| 组件 | 路径 | 说明 |
| --- | --- | --- |
| `FileUpload` | `components/common/FileUpload.vue` | 文件上传组件 |
| `ImageUpload` | `components/common/ImageUpload.vue` | 图片上传组件 |
| `ExcelFileUpload` | `components/common/ExcelFileUpload.vue` | Excel 文件上传组件 |

#### 5.4.2 富文本编辑器

| 组件 | 路径 | 说明 |
| --- | --- | --- |
| `Editor` | `components/common/Editor.vue` | 富文本编辑器（基于 Quill） |
| `RichTextEditor` | `components/common/RichTextEditor.vue` | 富文本编辑器（备用） |

#### 5.4.3 其他组件

| 组件 | 路径 | 说明 |
| --- | --- | --- |
| `BreadCrumbs` | `components/common/BreadCrumbs.vue` | 面包屑导航 |
| `SafeHtml` | `components/common/SafeHtml.vue` | 安全的 HTML 渲染 |
| `SvgIcon` | `components/SvgIcon/index.vue` | SVG 图标组件 |

### 5.6 工具函数

#### 5.6.1 存储工具

```typescript
// localStorage/sessionStorage 封装
import storage from '@/utils/storage'

storage.set('key', 'value')
storage.get('key')
storage.remove('key')

// 安全存储（加密 Token）
import { tokenStorage } from '@/utils/secureStorage'

tokenStorage.setToken('token')
tokenStorage.getToken()
tokenStorage.clearToken()
```

#### 5.5.2 HTTP 请求

```typescript
import http from '@/utils/http'

// GET 请求
const response = await http.get('/api/users')

// POST 请求
const response = await http.post('/api/users', { name: 'John' })

// 响应类型
interface ApiResponse<T> {
  code: number
  msg: string
  data: T
}
```

#### 5.6.3 表单验证

```typescript
import * as validate from '@/utils/validate'

// 验证邮箱
validate.isEmail('test@example.com')

// 验证手机号
validate.isMobile('13800138000')

// 验证身份证
validate.isIdCard('110101199001011234')
```

---

## 6. 设计规范

### 6.1 视觉设计规范

#### 6.1.1 色彩体系

Admin 前端采用浅色专业主题，提升可读性和专业感：

| 名称 | 颜色 | 用途 |
| --- | --- | --- |
| 主背景色 | `#F3F3F3` | 内容区背景 |
| 强调色（亮能蓝） | `#3A80FF` | 主按钮、链接、图表线条、激活状态 |
| 辅助色（薄雾灰） | `#A0A4B3` | 次级文字、表头说明 |
| 文字主色 | `#333` | 主要文字内容 |
| 文字次色 | `#666` | 次要文字内容 |
| 边框色 | `rgba(0,0,0,0.06)` | 边框、分割线 |
| 危险色 | `#FF5F5F` | 删除、警告提示 |
| 成功色 | `#4ECB71` | 状态 Pill / 成功提示 |

#### 6.1.2 字体与排版

- 基础字体：`"PingFang SC", "Microsoft YaHei", sans-serif`
- 标题：14~18px，字重 600；正文：13~14px；表格数值：13px 等宽对齐
- 表格列间距 ≥ 16px，保持可读性

#### 6.1.3 组件样式

- 卡片圆角：8px
- 卡片背景：`#FFFFFF`
- 卡片阴影：`0 2px 8px rgba(0,0,0,0.08)`
- 表格交替行背景：`#FAFAFA`

### 6.2 交互规范

#### 6.2.1 动效规范

- 动画时长：0.2~0.35s
- 动效类型：淡入/滑入/折叠
- 图表加载：渐显效果

#### 6.2.2 Hover 效果

- 按钮亮度：+8%
- 表格行背景：`rgba(58,128,255,0.08)`

#### 6.2.3 反馈机制

- Loading：Element Plus Loading / Skeleton
- 空状态：图标 + 20字以内文案 + CTA按钮
- 批量操作：多选后浮出工具条，显示选中数量和操作按钮
- 错误提示：表单字段下方红色提示，顶部使用 `ElMessage.error`

#### 6.2.4 响应式适配

| 终端 | 适配策略 |
| --- | --- |
| ≥1440px | 三栏布局（菜单 + 内容 + 侧卡片），仪表盘 4 列卡片 |
| 1200-1439px | 菜单可折叠，仪表盘 3 列卡片 |
| 992-1199px | 菜单默认折叠，表格横向滚动提示 |
| <992px | 显示"建议使用桌面端"，但仍可基本操作；隐藏图表动画 |

### 6.3 设计原则

遵循"效率优先·数据一目了然·稳健权限·浅色专业·低噪动效"的设计关键词，目标是最少点击完成配置、审批、统计等任务。

---

## 7. 开发规范

### 6.1 代码风格

#### 6.1.1 TypeScript

- 使用严格的 TypeScript 配置（`"strict": true`）
- 所有函数必须有类型注解
- 避免使用 `any`，优先使用 `unknown` 或具体类型
- 使用接口定义数据结构，避免使用对象字面量
- 使用 `import type` 导入类型定义
- 充分利用 TypeScript 的类型推断能力

#### 7.1.2 Vue 组件

- 使用 `<script setup lang="ts">` 语法糖
- 使用 Composition API（`<script setup>`）
- 组件名使用 PascalCase
- Props 和 Emits 必须定义类型
- 使用 `ref` 和 `reactive` 进行响应式数据管理
- 使用 `computed` 和 `watch` 处理派生状态

示例：

```vue
<script setup lang="ts">
import { ref, computed, defineEmits, defineProps, withDefaults } from 'vue'
import type { MenuRole } from '@/types/menu'

interface Props {
  title: string
  count?: number
  menu?: MenuRole
}

interface Emits {
  update: [value: number]
  change: [menu: MenuRole]
}

const props = withDefaults(defineProps<Props>(), {
  count: 0
})

const emit = defineEmits<Emits>()

const doubleCount = computed(() => props.count * 2)

const handleUpdate = (value: number) => {
  emit('update', value)
}
</script>
```

#### 7.1.3 样式规范

- 使用 SCSS 预处理器
- 遵循 BEM 命名规范
- 使用设计令牌（`styles/design-tokens.scss`）
- 响应式设计使用断点变量

### 6.2 文件命名

- **组件文件**：PascalCase，如 `UserList.vue`
- **工具文件**：camelCase，如 `http.ts`
- **类型文件**：camelCase，如 `api.ts`
- **常量文件**：camelCase，如 `menu.ts`

### 7.3 目录组织

- 按功能模块组织文件
- 相关文件放在同一目录
- 公共组件放在 `components/common/`
- 业务组件放在对应模块目录

### 7.4 Git 提交规范

使用 Conventional Commits 规范：

```
feat: 新功能
fix: 修复 bug
docs: 文档更新
style: 代码格式调整
refactor: 代码重构
test: 测试相关
chore: 构建/工具相关
```

### 7.5 注释规范

- 公共函数必须添加 JSDoc 注释
- 复杂逻辑添加行内注释
- TODO 注释标注待办事项

---

## 8. 构建与部署

### 7.1 构建

```bash
# 构建生产版本
npm run build
```

构建产物输出到 `dist/` 目录：
- `assets/js/`：JavaScript 文件（支持代码分割和按需加载）
- `assets/css/`：CSS 文件（包含 Element Plus 样式）
- `assets/img/`：图片资源（压缩优化）
- `index.html`：入口 HTML
- `lunar/`：农历组件资源
- `verifys/`：验证码组件资源

### 7.1.1 构建优化特性

项目采用以下构建优化策略：

- **代码分割**：按路由和第三方库进行智能分割
  - `element-plus`：Element Plus 组件库单独打包
  - `echarts`：ECharts 图表库单独打包
  - `vue-vendor`：Vue 相关库（Vue、Vue Router、Pinia）打包
  - `vendor`：其他第三方依赖打包

- **资源优化**：
  - 图片压缩和优化
  - CSS 和 JavaScript 代码压缩
  - Tree Shaking 移除未使用代码
  - Gzip 压缩支持

- **缓存策略**：
  - 文件名哈希确保缓存失效
  - 长期缓存优化

### 7.1.2 构建命令

```bash
# 生产构建
npm run build

# 构建分析（查看包大小）
npm run build:analyze

# 构建预览
npm run preview
```

### 7.2 预览构建结果

```bash
npm run preview
```

### 7.3 部署

#### 7.3.1 静态资源部署

将 `dist/` 目录内容部署到 Web 服务器（Nginx、Apache 等）。

#### 7.3.2 Nginx 配置示例

```nginx
server {
    listen 80;
    server_name admin.example.com;
    root /var/www/admin/dist;
    index index.html;

    location / {
        try_files $uri $uri/ /index.html;
    }

    location /springboot1ngh61a2 {
        proxy_pass http://localhost:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

#### 7.3.3 Docker 部署

项目支持 Docker 容器化部署：

```dockerfile
# Dockerfile 示例
FROM nginx:alpine
COPY dist/ /usr/share/nginx/html/
COPY nginx.conf /etc/nginx/nginx.conf
EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
```

#### 7.3.4 环境变量配置

生产环境需要配置：
- `VITE_API_BASE_URL`：API 基础 URL
- `VITE_APP_TITLE`：应用标题
- `VITE_APP_ENV`：环境标识（production）

#### 7.3.5 CI/CD 集成

项目支持现代 CI/CD 流程：
- GitHub Actions 自动化构建
- Docker 镜像构建和推送
- 自动化部署到云服务器
- 回滚机制支持

---

## 8. 测试

### 8.1 单元测试

使用 Vitest 进行单元测试：

```bash
# 运行单元测试
npm run test:unit

# 监听模式
npm run test:unit:watch

# 生成覆盖率报告
npm run test:coverage
```

测试文件位置：`tests/unit/`（共32个测试文件）

测试文件结构：
```
tests/unit/
├── components/     # 组件测试（2个文件）
├── constants/      # 常量配置测试（3个文件）
├── stores/         # 状态管理测试（1个文件）
├── utils/          # 工具函数测试（14个文件）
└── views/          # 页面组件测试（6个文件）
```

### 8.2 端到端测试

使用 Playwright 进行端到端测试：

```bash
# 安装浏览器依赖（首次运行）
npx playwright install

# 运行 E2E 测试
npm run test:e2e

# 可视化模式
npm run test:e2e:ui

# 调试模式
npm run test:e2e:debug

# 查看报告
npm run test:e2e:report
```

测试文件位置：`tests/e2e/`（共3个集成测试文件）

集成测试文件：
```
tests/integration/
├── component-interaction.test.ts  # 组件交互测试
├── data-flow.test.ts             # 数据流测试
└── navigation-flow.test.ts       # 导航流测试
```

### 8.3 测试覆盖率

项目要求：
- 单元测试覆盖率 >= 80%
- 关键功能覆盖率 >= 90%

---

## 9. 常见问题

### 9.1 开发环境问题

#### Q: 启动开发服务器失败

**A:** 检查：
1. Node.js 版本是否符合要求
2. 依赖是否完整安装（`npm install`）
3. 端口 8081 是否被占用

#### Q: 热更新不生效

**A:** 
1. 检查文件是否在 `src/` 目录下
2. 检查 Vite 配置是否正确
3. 重启开发服务器

### 9.2 构建问题

#### Q: 构建失败

**A:** 检查：
1. TypeScript 类型错误（`npm run type-check`）
2. ESLint 错误（`npm run lint:check`）
3. 依赖版本冲突

#### Q: 构建产物过大

**A:**
1. 检查是否有未使用的依赖
2. 使用代码分割（路由懒加载）
3. 优化图片资源

### 9.3 运行时问题

#### Q: Token 失效后无法跳转登录页

**A:** 检查路由守卫配置，确保正确处理 Token 失效情况。

#### Q: API 请求失败

**A:** 检查：
1. 后端服务是否启动
2. 代理配置是否正确
3. Token 是否正确注入
4. CORS 配置是否正确

### 9.4 类型问题

#### Q: TypeScript 类型错误

**A:**
1. 检查类型定义文件是否存在
2. 使用 `@ts-ignore` 临时忽略（不推荐）
3. 添加正确的类型注解

### 9.5 安全问题

#### Q: Token 被窃取怎么办

**A:**
1. 项目使用加密存储（crypto-js）保护 Token
2. 实施 CSRF 防护，防止跨站请求伪造
3. 路由守卫会自动验证 Token 有效性
4. 敏感操作会被记录到安全审计日志

#### Q: 如何防止暴力破解登录

**A:**
1. 实现请求限流（`rateLimiter.ts`）
2. 登录失败后增加延迟
3. 多次失败后要求验证码
4. 记录可疑登录尝试

#### Q: 敏感数据如何保护

**A:**
1. 使用 `mask.ts` 进行数据脱敏显示
2. 密码等敏感字段不会在前端明文显示
3. 文件上传有类型和大小限制
4. API 请求会验证用户权限

---

## 10. 参考资料

### 10.1 官方文档

- [Vue 3 文档](https://cn.vuejs.org/)
- [TypeScript 文档](https://www.typescriptlang.org/zh/)
- [Vite 文档](https://cn.vitejs.dev/)
- [Element Plus 文档](https://element-plus.org/zh-CN/)
- [Pinia 文档](https://pinia.vuejs.org/zh/)
- [Vue Router 文档](https://router.vuejs.org/zh/)
- [ECharts 文档](https://echarts.apache.org/zh/index.html)
- [Axios 文档](https://axios-http.com/zh/docs/)
- [DOMPurify 文档](https://github.com/cure53/DOMPurify)

### 10.2 项目文档

- [项目概览](./README.md)
- [架构文档](./ARCHITECTURE.md)
- [前端代码资产清单](./FRONTEND_CODE_ASSETS.md)
- [前端迁移状态](./FRONTEND_MIGRATION_STATUS.md)
- [Admin 需求总览](./ADMIN_OVERVIEW_REQUIREMENTS.md)
- [Admin 布局需求](./ADMIN_LAYOUT_REQUIREMENTS.md)
- [Admin 登录需求](./ADMIN_LOGIN_REQUIREMENTS.md)
- [Admin 注册需求](./ADMIN_REGISTER_REQUIREMENTS.md)
- [Admin 系统管理需求](./ADMIN_SYSTEM_MANAGEMENT_REQUIREMENTS.md)
- [Admin CRUD 模块需求](./ADMIN_MODULE_CRUD_REQUIREMENTS.md)
- [Admin 前端安全改进](./ADMIN_FRONTEND_SECURITY_IMPROVEMENTS.md)
- [前端技术演进](./FRONTEND_TECHNOLOGY_EVOLUTION.md)
- [前端安全实践](./FRONTEND_SECURITY_PRACTICES.md)

### 10.3 工具文档

- [ESLint 文档](https://eslint.org/)
- [Prettier 文档](https://prettier.io/)
- [Stylelint 文档](https://stylelint.io/)
- [Vitest 文档](https://vitest.dev/)
- [Playwright 文档](https://playwright.dev/)
- [Husky 文档](https://typicode.github.io/husky/)
- [lint-staged 文档](https://github.com/okonet/lint-staged)
- [CryptoJS 文档](https://cryptojs.gitbook.io/docs/)

---

## 附录

### A. 项目配置说明

#### A.1 Vite 配置 (`vite.config.ts`)

- **插件配置**：
  - Vue 插件（支持 Composition API）
  - 自动导入（Vue API、组件）
  - SVG 图标插件（支持 159 个图标）
- **路径别名**：`@` → `src/`
- **代理配置**：`/springboot1ngh61a2` → `http://localhost:8080`
- **构建配置**：
  - 输出目录：`dist/`
  - 代码分割：按库和模块分离
  - 资源处理：JS、CSS、图片优化
  - Sass 静默弃用警告

#### A.2 TypeScript 配置 (`tsconfig.json`)

- **严格模式**：启用所有严格检查选项
- **路径映射**：`@/*` → `src/*`
- **模块解析**：bundler 模式
- **目标版本**：ES2020
- **类型检查**：
  - 严格的 null 检查
  - 严格的函数类型检查
  - 严格的属性初始化检查
  - 禁止隐式 any 类型

#### A.3 代码检查配置

- **ESLint**：`.eslintrc.js`
- **Prettier**：`.prettierrc`
- **Stylelint**：`.stylelintrc.cjs`

### B. 开发工作流

1. **创建功能分支**
   ```bash
   git checkout -b feat/new-feature
   ```

2. **开发功能**
   - 编写代码
   - 运行代码检查
   - 编写测试

3. **提交代码**
   ```bash
   git add .
   git commit -m "feat: 新功能描述"
   ```

4. **推送并创建 PR**
   ```bash
   git push origin feat/new-feature
   ```

### C. 性能优化建议

1. **代码分割**：使用路由懒加载
2. **资源优化**：压缩图片、使用 CDN
3. **缓存策略**：合理使用浏览器缓存
4. **打包优化**：Tree-shaking、代码压缩

---

**文档维护者**：开发团队
**最后更新**：2025-11-16
**文档版本**：v2.2.0



