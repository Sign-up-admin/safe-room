---
title: TESTING IMPLEMENTATION
version: v1.0.0
last_updated: 2025-11-16
status: active
category: technical
---
# æµ‹è¯•å®ç°æŒ‡å—

## ğŸ“‹ ç›®å½•

- [å‰ç«¯æµ‹è¯•å®ç°](#å‰ç«¯æµ‹è¯•å®ç°)
- [åç«¯æµ‹è¯•å®ç°](#åç«¯æµ‹è¯•å®ç°)
- [é›†æˆæµ‹è¯•å®ç°](#é›†æˆæµ‹è¯•å®ç°)
- [æµ‹è¯•æ•°æ®ç®¡ç†](#æµ‹è¯•æ•°æ®ç®¡ç†)
- [Mockå’ŒStubä½¿ç”¨](#mockå’Œstubä½¿ç”¨)
- [æµ‹è¯•é…ç½®ç®¡ç†](#æµ‹è¯•é…ç½®ç®¡ç†)

## ğŸ¨ å‰ç«¯æµ‹è¯•å®ç°

### Vitesté…ç½®å’Œè®¾ç½®

#### 1. é…ç½®æ–‡ä»¶ç»“æ„

```typescript
// vitest.config.ts (å‰ç«¯)
import { defineConfig } from 'vitest/config'
import vue from '@vitejs/plugin-vue'

export default defineConfig({
  plugins: [vue()],
  test: {
    globals: true,
    environment: 'happy-dom',
    setupFiles: ['./tests/setup/vitest.setup.ts'],
    include: [
      'tests/unit/**/*.{test,spec}.{js,mjs,cjs,ts,mts,cts,jsx,tsx}',
      'src/**/*.{test,spec}.{js,mjs,cjs,ts,mts,cts,jsx,tsx}'
    ],
    exclude: [
      '**/node_modules/**',
      '**/dist/**',
      '**/cypress/**',
      '**/.{idea,git,cache,output,temp}/**'
    ],
    coverage: {
      provider: 'v8',
      reporter: ['text', 'lcov', 'html', 'json', 'json-summary'],
      include: ['src/**/*.{ts,tsx,vue,js,jsx}'],
      exclude: [
        'src/main.ts',
        'src/main.js',
        'src/router/**',
        'src/**/__tests__/**',
        'src/**/*.d.ts',
        'src/**/types/**',
        'src/**/env.d.ts',
        '**/*.config.{js,ts}',
        '**/*.spec.{ts,js}',
        '**/*.test.{ts,js}',
        '**/tests/**',
        '**/*.config.{js,ts}'
      ],
      thresholds: {
        lines: 30,
        functions: 30,
        branches: 25,
        statements: 30
      }
    }
  },
  optimizeDeps: {
    exclude: ['vue-demi']
  }
})
```

```typescript
// vitest.config.ts (ç®¡ç†åå°)
import { defineConfig } from 'vitest/config'
import vue from '@vitejs/plugin-vue'

export default defineConfig({
  plugins: [vue()],
  test: {
    globals: true,
    environment: 'happy-dom',
    setupFiles: ['./tests/setup/vitest.setup.ts'],
    coverage: {
      provider: 'v8',
      include: ['src/**/*.{ts,tsx,vue,js,jsx}'],
      thresholds: {
        lines: 80,
        functions: 80,
        branches: 70,
        statements: 80
      }
    }
  }
})
```

#### 2. æµ‹è¯•ç¯å¢ƒè®¾ç½®

```typescript
// tests/setup/vitest.setup.ts
import { beforeAll, afterAll, afterEach } from 'vitest'
import { cleanup } from '@testing-library/vue'

// å…¨å±€æµ‹è¯•è®¾ç½®
beforeAll(() => {
  // è®¾ç½®å…¨å±€å˜é‡
  global.HTMLElement.prototype.scrollIntoView = vi.fn()
  global.HTMLElement.prototype.getBoundingClientRect = vi.fn(() => ({
    width: 100,
    height: 100,
    top: 0,
    left: 0,
    bottom: 100,
    right: 100
  }))
})

// æ¯ä¸ªæµ‹è¯•åæ¸…ç†
afterEach(() => {
  cleanup()
  vi.clearAllMocks()
})

// Mock window.matchMedia
Object.defineProperty(window, 'matchMedia', {
  writable: true,
  value: vi.fn().mockImplementation(query => ({
    matches: false,
    media: query,
    onchange: null,
    addListener: vi.fn(), // deprecated
    removeListener: vi.fn(), // deprecated
    addEventListener: vi.fn(),
    removeEventListener: vi.fn(),
    dispatchEvent: vi.fn(),
  })),
})

// Mock IntersectionObserver
global.IntersectionObserver = class IntersectionObserver {
  constructor() {}
  disconnect() {}
  observe() {}
  unobserve() {}
}
```

### ç»„ä»¶å•å…ƒæµ‹è¯•

#### 1. åŸºç¡€ç»„ä»¶æµ‹è¯•

```typescript
// src/components/Button/__tests__/Button.test.ts
import { describe, it, expect } from 'vitest'
import { mount } from '@vue/test-utils'
import Button from '../Button.vue'

describe('Button', () => {
  it('renders correctly', () => {
    const wrapper = mount(Button, {
      props: {
        text: 'Click me'
      }
    })

    expect(wrapper.text()).toBe('Click me')
  })

  it('emits click event when clicked', async () => {
    const wrapper = mount(Button)
    const button = wrapper.find('button')

    await button.trigger('click')

    expect(wrapper.emitted('click')).toBeTruthy()
  })

  it('applies correct CSS classes', () => {
    const wrapper = mount(Button, {
      props: {
        variant: 'primary',
        size: 'large'
      }
    })

    expect(wrapper.classes()).toContain('button--primary')
    expect(wrapper.classes()).toContain('button--large')
  })
})
```

#### 2. è¡¨å•ç»„ä»¶æµ‹è¯•

```typescript
// src/components/LoginForm/__tests__/LoginForm.test.ts
import { describe, it, expect } from 'vitest'
import { mount } from '@vue/test-utils'
import { createTestingPinia } from '@pinia/testing'
import LoginForm from '../LoginForm.vue'

describe('LoginForm', () => {
  const createWrapper = () => {
    return mount(LoginForm, {
      global: {
        plugins: [createTestingPinia()]
      }
    })
  }

  it('validates required fields', async () => {
    const wrapper = createWrapper()

    const submitButton = wrapper.find('[data-test="submit"]')
    await submitButton.trigger('click')

    expect(wrapper.text()).toContain('ç”¨æˆ·åä¸èƒ½ä¸ºç©º')
    expect(wrapper.text()).toContain('å¯†ç ä¸èƒ½ä¸ºç©º')
  })

  it('submits form with valid data', async () => {
    const wrapper = createWrapper()

    await wrapper.find('[data-test="username"]').setValue('testuser')
    await wrapper.find('[data-test="password"]').setValue('password123')

    const submitButton = wrapper.find('[data-test="submit"]')
    await submitButton.trigger('click')

    // éªŒè¯æäº¤äº‹ä»¶
    expect(wrapper.emitted('submit')).toBeTruthy()
    expect(wrapper.emitted('submit')[0][0]).toEqual({
      username: 'testuser',
      password: 'password123'
    })
  })
})
```

### ç»„åˆå¼å‡½æ•°æµ‹è¯•

```typescript
// src/composables/__tests__/useAuth.test.ts
import { describe, it, expect, vi } from 'vitest'
import { createTestingPinia } from '@pinia/testing'
import { useAuth } from '../useAuth'

describe('useAuth', () => {
  const createComposable = () => {
    const pinia = createTestingPinia()
    return useAuth()
  }

  it('returns initial state', () => {
    const { isAuthenticated, user } = createComposable()

    expect(isAuthenticated.value).toBe(false)
    expect(user.value).toBeNull()
  })

  it('logs in user successfully', async () => {
    const { login, isAuthenticated, user } = createComposable()

    // Mock API response
    vi.mocked(api.login).mockResolvedValue({
      success: true,
      data: { id: 1, username: 'testuser' }
    })

    await login('testuser', 'password')

    expect(isAuthenticated.value).toBe(true)
    expect(user.value).toEqual({ id: 1, username: 'testuser' })
  })

  it('handles login failure', async () => {
    const { login, error } = createComposable()

    vi.mocked(api.login).mockRejectedValue(new Error('Invalid credentials'))

    await login('testuser', 'wrongpassword')

    expect(error.value).toBe('Invalid credentials')
  })
})
```

### E2Eæµ‹è¯•å®ç°

#### 1. Playwrighté…ç½®

```typescript
// playwright.config.ts
import { defineConfig, devices } from '@playwright/test'

export default defineConfig({
  testDir: './tests/e2e',
  fullyParallel: true,
  forbidOnly: !!process.env.CI,
  retries: process.env.CI ? 2 : 0,
  workers: process.env.CI ? 1 : undefined,
  reporter: 'html',

  use: {
    baseURL: process.env.BASE_URL || 'http://localhost:8080',
    trace: 'on-first-retry',
    screenshot: 'only-on-failure',
    video: 'retain-on-failure'
  },

  projects: [
    {
      name: 'chromium',
      use: { ...devices['Desktop Chrome'] },
    },
    {
      name: 'firefox',
      use: { ...devices['Desktop Firefox'] },
    },
    {
      name: 'webkit',
      use: { ...devices['Desktop Safari'] },
    },
  ],

  webServer: process.env.CI ? undefined : {
    command: 'npm run dev',
    port: 8080,
    reuseExistingServer: !process.env.CI,
  },
})
```

#### 2. é¡µé¢å¯¹è±¡æ¨¡å¼

```typescript
// tests/e2e/pages/LoginPage.ts
export class LoginPage {
  constructor(private page: Page) {}

  async goto() {
    await this.page.goto('/login')
  }

  async login(username: string, password: string) {
    await this.page.fill('[data-test="username"]', username)
    await this.page.fill('[data-test="password"]', password)
    await this.page.click('[data-test="submit"]')
  }

  async getErrorMessage() {
    return this.page.textContent('[data-test="error-message"]')
  }

  async isLoggedIn() {
    return this.page.url().includes('/dashboard')
  }
}
```

#### 3. E2Eæµ‹è¯•ç”¨ä¾‹

```typescript
// tests/e2e/auth/login.spec.ts
import { test, expect } from '@playwright/test'
import { LoginPage } from '../pages/LoginPage'

test.describe('ç”¨æˆ·ç™»å½•', () => {
  test('æˆåŠŸç™»å½•', async ({ page }) => {
    const loginPage = new LoginPage(page)

    await loginPage.goto()
    await loginPage.login('admin', 'admin')

    await expect(page).toHaveURL('/admin/dashboard')
  })

  test('ç™»å½•å¤±è´¥æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯', async ({ page }) => {
    const loginPage = new LoginPage(page)

    await loginPage.goto()
    await loginPage.login('invalid', 'invalid')

    const errorMessage = await loginPage.getErrorMessage()
    expect(errorMessage).toContain('ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯')
  })
})
```

## ğŸ”§ åç«¯æµ‹è¯•å®ç°

### JUnitæµ‹è¯•é…ç½®

#### 1. åŸºç¡€æµ‹è¯•é…ç½®

```java
// src/test/java/com/AbstractTestBase.java
@SpringBootTest
@ActiveProfiles("test")
@TestInstance(TestInstance.Lifecycle.PER_CLASS)
public abstract class AbstractTestBase {

    @Autowired
    protected ObjectMapper objectMapper;

    @Autowired
    protected TestUtils testUtils;

    @BeforeAll
    void setup() {
        // å…¨å±€æµ‹è¯•è®¾ç½®
    }

    @AfterEach
    void cleanup() {
        // æ¯ä¸ªæµ‹è¯•åçš„æ¸…ç†
    }
}
```

#### 2. Controlleré›†æˆæµ‹è¯•

```java
// src/test/java/com/controller/UserControllerTest.java
@WebMvcTest(UserController.class)
@WithMockUser
public class UserControllerTest extends AbstractTestBase {

    @Autowired
    private MockMvc mockMvc;

    @MockBean
    private UserService userService;

    @Test
    public void shouldReturnUserWhenExists() throws Exception {
        // Given
        UserDTO userDTO = testUtils.createTestUserDTO();
        when(userService.getUserById(1L)).thenReturn(userDTO);

        // When & Then
        mockMvc.perform(get("/api/users/{id}", 1L))
               .andExpect(status().isOk())
               .andExpect(jsonPath("$.username").value("testuser"))
               .andExpect(jsonPath("$.email").value("test@example.com"));
    }

    @Test
    public void shouldReturn404WhenUserNotFound() throws Exception {
        // Given
        when(userService.getUserById(999L)).thenThrow(new UserNotFoundException());

        // When & Then
        mockMvc.perform(get("/api/users/{id}", 999L))
               .andExpect(status().isNotFound())
               .andExpect(jsonPath("$.code").value(404))
               .andExpect(jsonPath("$.msg").value("ç”¨æˆ·ä¸å­˜åœ¨"));
    }
}
```

#### 3. Serviceå±‚å•å…ƒæµ‹è¯•

```java
// src/test/java/com/service/UserServiceImplTest.java
@ExtendWith(MockitoExtension.class)
class UserServiceImplTest {

    @InjectMocks
    private UserServiceImpl userService;

    @Mock
    private UserDao userDao;

    @Mock
    private PasswordEncoder passwordEncoder;

    @Test
    void shouldCreateUserSuccessfully() {
        // Given
        UserEntity userEntity = testUtils.createTestUserEntity();
        when(userDao.insert(userEntity)).thenReturn(1);
        when(passwordEncoder.encode("password123")).thenReturn("encodedPassword");

        // When
        UserDTO result = userService.createUser(testUtils.createUserCreateRequest());

        // Then
        assertThat(result).isNotNull();
        assertThat(result.getUsername()).isEqualTo("testuser");
        verify(userDao).insert(any(UserEntity.class));
    }

    @Test
    void shouldThrowExceptionWhenUsernameExists() {
        // Given
        when(userDao.selectByUsername("existinguser")).thenReturn(new UserEntity());

        // When & Then
        assertThrows(UserAlreadyExistsException.class, () -> {
            userService.createUser(UserCreateRequest.builder()
                    .username("existinguser")
                    .build());
        });
    }
}
```

#### 4. DAOå±‚é›†æˆæµ‹è¯•

```java
// src/test/java/com/dao/UserDaoTest.java
@SpringBootTest
@Sql(scripts = "/test-data.sql", executionPhase = BEFORE_TEST_METHOD)
@Sql(scripts = "/cleanup.sql", executionPhase = AFTER_TEST_METHOD)
class UserDaoTest extends AbstractTestBase {

    @Autowired
    private UserDao userDao;

    @Test
    void shouldInsertUser() {
        // Given
        UserEntity user = testUtils.createTestUserEntity();

        // When
        int result = userDao.insert(user);

        // Then
        assertThat(result).isEqualTo(1);
        UserEntity inserted = userDao.selectById(user.getId());
        assertThat(inserted).isNotNull();
        assertThat(inserted.getUsername()).isEqualTo("testuser");
    }

    @Test
    void shouldFindUserByUsername() {
        // Given - test-data.sqlä¸­å·²æ’å…¥æµ‹è¯•æ•°æ®

        // When
        UserEntity user = userDao.selectByUsername("testuser");

        // Then
        assertThat(user).isNotNull();
        assertThat(user.getEmail()).isEqualTo("test@example.com");
    }
}
```

### JaCoCoè¦†ç›–ç‡é…ç½®

```xml
<!-- pom.xml -->
<properties>
    <jacoco.version>0.8.11</jacoco.version>
    <maven.surefire.version>3.2.5</maven.surefire.version>
</properties>

<build>
    <plugins>
        <!-- JaCoCoæ’ä»¶ -->
        <plugin>
            <groupId>org.jacoco</groupId>
            <artifactId>jacoco-maven-plugin</artifactId>
            <version>${jacoco.version}</version>
            <executions>
                <execution>
                    <goals>
                        <goal>prepare-agent</goal>
                    </goals>
                </execution>
                <execution>
                    <id>report</id>
                    <phase>test</phase>
                    <goals>
                        <goal>report</goal>
                    </goals>
                </execution>
                <execution>
                    <id>check</id>
                    <phase>test</phase>
                    <goals>
                        <goal>check</goal>
                    </goals>
                    <configuration>
                        <rules>
                            <rule>
                                <element>BUNDLE</element>
                                <limits>
                                    <limit>
                                        <counter>LINE</counter>
                                        <value>COVEREDRATIO</value>
                                        <minimum>60%</minimum>
                                    </limit>
                                    <limit>
                                        <counter>BRANCH</counter>
                                        <value>COVEREDRATIO</value>
                                        <minimum>50%</minimum>
                                    </limit>
                                </limits>
                            </rule>
                        </rules>
                    </configuration>
                </execution>
            </executions>
        </plugin>

        <!-- Surefireæ’ä»¶é…ç½® -->
        <plugin>
            <groupId>org.apache.maven.plugins</groupId>
            <artifactId>maven-surefire-plugin</artifactId>
            <version>${maven.surefire.version}</version>
            <configuration>
                <includes>
                    <include>**/*Test.java</include>
                </includes>
                <excludes>
                    <exclude>**/*IT.java</exclude>
                </excludes>
            </configuration>
        </plugin>
    </plugins>
</build>
```

## ğŸ”— é›†æˆæµ‹è¯•å®ç°

### ç«¯åˆ°ç«¯é›†æˆæµ‹è¯•

#### 1. å®Œæ•´ä¸šåŠ¡æµç¨‹æµ‹è¯•

```java
// src/test/java/com/integration/CourseBookingIntegrationTest.java
@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)
@Sql(scripts = "/integration-test-data.sql")
public class CourseBookingIntegrationTest extends AbstractTestBase {

    @Autowired
    private TestRestTemplate restTemplate;

    @LocalServerPort
    private int port;

    private String baseUrl;

    @BeforeEach
    void setUp() {
        this.baseUrl = "http://localhost:" + port;
    }

    @Test
    void shouldCompleteFullBookingFlow() {
        // 1. ç”¨æˆ·ç™»å½•
        String token = login("testuser", "password");

        // 2. æµè§ˆè¯¾ç¨‹åˆ—è¡¨
        ResponseEntity<CourseDTO[]> coursesResponse = restTemplate.exchange(
            baseUrl + "/api/courses",
            HttpMethod.GET,
            createAuthHeaders(token),
            CourseDTO[].class
        );

        assertThat(coursesResponse.getStatusCode()).isEqualTo(HttpStatus.OK);
        assertThat(coursesResponse.getBody()).isNotEmpty();

        Long courseId = coursesResponse.getBody()[0].getId();

        // 3. æŸ¥çœ‹è¯¾ç¨‹è¯¦æƒ…
        ResponseEntity<CourseDTO> courseDetailResponse = restTemplate.exchange(
            baseUrl + "/api/courses/" + courseId,
            HttpMethod.GET,
            createAuthHeaders(token),
            CourseDTO.class
        );

        assertThat(courseDetailResponse.getStatusCode()).isEqualTo(HttpStatus.OK);

        // 4. é¢„çº¦è¯¾ç¨‹
        BookingRequest bookingRequest = new BookingRequest(courseId, LocalDateTime.now().plusDays(1));

        ResponseEntity<BookingDTO> bookingResponse = restTemplate.exchange(
            baseUrl + "/api/bookings",
            HttpMethod.POST,
            new HttpEntity<>(bookingRequest, createAuthHeaders(token).getHeaders()),
            BookingDTO.class
        );

        assertThat(bookingResponse.getStatusCode()).isEqualTo(HttpStatus.CREATED);
        assertThat(bookingResponse.getBody().getStatus()).isEqualTo("confirmed");
    }

    private String login(String username, String password) {
        LoginRequest loginRequest = new LoginRequest(username, password);

        ResponseEntity<LoginResponse> response = restTemplate.postForEntity(
            baseUrl + "/api/auth/login",
            loginRequest,
            LoginResponse.class
        );

        return response.getBody().getToken();
    }

    private HttpHeaders createAuthHeaders(String token) {
        HttpHeaders headers = new HttpHeaders();
        headers.set("Authorization", "Bearer " + token);
        return headers;
    }
}
```

#### 2. å¾®æœåŠ¡é›†æˆæµ‹è¯•

```java
// ä½¿ç”¨WireMockæ¨¡æ‹Ÿå¤–éƒ¨æœåŠ¡
@SpringBootTest
@AutoConfigureWireMock(port = 0)
public class PaymentIntegrationTest {

    @Autowired
    private PaymentService paymentService;

    @Test
    void shouldProcessPaymentSuccessfully() {
        // Given - WireMockè®¾ç½®
        stubFor(post(urlEqualTo("/api/payment/process"))
            .willReturn(aResponse()
                .withStatus(200)
                .withHeader("Content-Type", "application/json")
                .withBody("""
                    {
                        "success": true,
                        "transactionId": "txn_123456",
                        "amount": 100.00
                    }
                """)));

        // When
        PaymentResult result = paymentService.processPayment(new PaymentRequest(100.00, "card_123"));

        // Then
        assertThat(result.isSuccess()).isTrue();
        assertThat(result.getTransactionId()).isEqualTo("txn_123456");
    }
}
```

## ğŸ“Š æµ‹è¯•æ•°æ®ç®¡ç†

### æµ‹è¯•æ•°æ®ç­–ç•¥

#### 1. å›ºå®šæµ‹è¯•æ•°æ®

```sql
-- src/test/resources/test-data.sql
-- åŸºç¡€ç”¨æˆ·æ•°æ®
INSERT INTO users (id, username, password, email, role, created_at) VALUES
(1, 'admin', '$2a$10$encryptedpassword', 'admin@example.com', 'ADMIN', NOW()),
(2, 'testuser', '$2a$10$encryptedpassword', 'user@example.com', 'USER', NOW());

-- è¯¾ç¨‹æ•°æ®
INSERT INTO courses (id, name, description, instructor_id, price, created_at) VALUES
(1, 'ç‘œä¼½å…¥é—¨', 'åŸºç¡€ç‘œä¼½è¯¾ç¨‹', 1, 99.00, NOW()),
(2, 'åŠ›é‡è®­ç»ƒ', 'è‚Œè‚‰åŠ›é‡è®­ç»ƒè¯¾ç¨‹', 1, 129.00, NOW());

-- è¯¾ç¨‹ç±»å‹æ•°æ®
INSERT INTO course_types (id, name, description) VALUES
(1, 'ç‘œä¼½', 'ç‘œä¼½è¯¾ç¨‹'),
(2, 'å¥èº«', 'åŠ›é‡è®­ç»ƒè¯¾ç¨‹');
```

#### 2. åŠ¨æ€æµ‹è¯•æ•°æ®ç”Ÿæˆ

```java
// src/test/java/com/utils/TestDataFactory.java
@Component
public class TestDataFactory {

    private static final Faker faker = new Faker();

    public UserEntity createRandomUser() {
        UserEntity user = new UserEntity();
        user.setUsername(faker.name().username());
        user.setEmail(faker.internet().emailAddress());
        user.setPassword("password123");
        user.setPhone(faker.phoneNumber().phoneNumber());
        user.setCreatedAt(LocalDateTime.now());
        return user;
    }

    public CourseEntity createRandomCourse() {
        CourseEntity course = new CourseEntity();
        course.setName(faker.book().title());
        course.setDescription(faker.lorem().paragraph());
        course.setPrice(faker.number().randomDouble(2, 50, 500));
        course.setDuration(faker.number().numberBetween(30, 120));
        course.setMaxParticipants(faker.number().numberBetween(5, 20));
        return course;
    }

    public BookingEntity createRandomBooking(Long userId, Long courseId) {
        BookingEntity booking = new BookingEntity();
        booking.setUserId(userId);
        booking.setCourseId(courseId);
        booking.setBookingTime(LocalDateTime.now().plusDays(faker.number().numberBetween(1, 30)));
        booking.setStatus("confirmed");
        return booking;
    }
}
```

### æµ‹è¯•æ•°æ®æ¸…ç†ç­–ç•¥

#### 1. è‡ªåŠ¨æ¸…ç†æ³¨è§£

```java
// src/test/java/com/config/TestDataCleanup.java
@Component
public class TestDataCleanup {

    @Autowired
    private JdbcTemplate jdbcTemplate;

    @PostConstruct
    public void setup() {
        // æ³¨å†Œæ¸…ç†é’©å­
        Runtime.getRuntime().addShutdownHook(new Thread(this::cleanupAllTestData));
    }

    @PreDestroy
    public void cleanupAllTestData() {
        try {
            jdbcTemplate.execute("TRUNCATE TABLE bookings, courses, users RESTART IDENTITY CASCADE");
        } catch (Exception e) {
            // è®°å½•æ¸…ç†å¤±è´¥çš„æ—¥å¿—
        }
    }

    public void cleanupSpecificTables(String... tableNames) {
        for (String tableName : tableNames) {
            try {
                jdbcTemplate.execute("TRUNCATE TABLE " + tableName + " RESTART IDENTITY CASCADE");
            } catch (Exception e) {
                // è®°å½•æ¸…ç†å¤±è´¥çš„æ—¥å¿—
            }
        }
    }
}
```

#### 2. æµ‹è¯•æ–¹æ³•çº§æ¸…ç†

```java
@Test
@Sql(scripts = "/setup-test-data.sql", executionPhase = BEFORE_TEST_METHOD)
@Sql(scripts = "/cleanup-test-data.sql", executionPhase = AFTER_TEST_METHOD)
void shouldTestBusinessLogic() {
    // æµ‹è¯•é€»è¾‘
}
```

## ğŸ­ Mockå’ŒStubä½¿ç”¨

### Mockito Mockç­–ç•¥

#### 1. Serviceå±‚Mock

```java
@ExtendWith(MockitoExtension.class)
class CourseServiceImplTest {

    @InjectMocks
    private CourseServiceImpl courseService;

    @Mock
    private CourseDao courseDao;

    @Mock
    private UserDao userDao;

    @Mock
    private NotificationService notificationService;

    @Test
    void shouldCreateCourseSuccessfully() {
        // Given
        CourseCreateRequest request = CourseCreateRequest.builder()
            .name("æ–°è¯¾ç¨‹")
            .description("è¯¾ç¨‹æè¿°")
            .instructorId(1L)
            .build();

        CourseEntity savedEntity = CourseEntity.builder()
            .id(1L)
            .name("æ–°è¯¾ç¨‹")
            .description("è¯¾ç¨‹æè¿°")
            .instructorId(1L)
            .build();

        when(courseDao.insert(any(CourseEntity.class))).thenReturn(1);
        when(courseDao.selectById(1L)).thenReturn(savedEntity);

        // When
        CourseDTO result = courseService.createCourse(request);

        // Then
        assertThat(result.getName()).isEqualTo("æ–°è¯¾ç¨‹");
        verify(courseDao).insert(any(CourseEntity.class));
        verify(notificationService).sendNotification(anyString(), anyString());
    }
}
```

#### 2. å¤–éƒ¨æœåŠ¡Mock

```java
@SpringBootTest
public class WeatherServiceIntegrationTest {

    @Autowired
    private WeatherService weatherService;

    @Test
    void shouldReturnWeatherData() {
        // ä½¿ç”¨WireMock
        stubFor(get(urlEqualTo("/api/weather/current"))
            .willReturn(aResponse()
                .withStatus(200)
                .withHeader("Content-Type", "application/json")
                .withBody("""
                    {
                        "temperature": 22.5,
                        "condition": "sunny",
                        "humidity": 65
                    }
                """)));

        // When
        WeatherData weather = weatherService.getCurrentWeather("Beijing");

        // Then
        assertThat(weather.getTemperature()).isEqualTo(22.5);
        assertThat(weather.getCondition()).isEqualTo("sunny");
    }
}
```

### å‰ç«¯Mockç­–ç•¥

#### 1. APIè¯·æ±‚Mock

```typescript
// tests/setup/api-mocks.ts
import axios from 'axios'
import MockAdapter from 'axios-mock-adapter'

const mock = new MockAdapter(axios)

// ç”¨æˆ·API Mock
mock.onGet('/api/users').reply(200, [
  { id: 1, name: 'å¼ ä¸‰', email: 'zhangsan@example.com' },
  { id: 2, name: 'æå››', email: 'lisi@example.com' }
])

mock.onGet('/api/users/1').reply(200, {
  id: 1,
  name: 'å¼ ä¸‰',
  email: 'zhangsan@example.com'
})

// è¯¾ç¨‹API Mock
mock.onGet('/api/courses').reply(200, [
  { id: 1, name: 'ç‘œä¼½å…¥é—¨', price: 99 },
  { id: 2, name: 'åŠ›é‡è®­ç»ƒ', price: 129 }
])

export { mock }
```

#### 2. Vueç»„ä»¶Mock

```typescript
// tests/utils/component-mocks.ts
import { vi } from 'vitest'

// Mockå­ç»„ä»¶
vi.mock('../components/Modal.vue', () => ({
  default: {
    name: 'Modal',
    props: ['visible', 'title'],
    template: '<div v-if="visible" class="modal"><slot /></div>'
  }
}))

// Mockç¬¬ä¸‰æ–¹åº“
vi.mock('vue-router', () => ({
  useRouter: () => ({
    push: vi.fn(),
    replace: vi.fn(),
    go: vi.fn()
  }),
  useRoute: () => ({
    params: {},
    query: {},
    name: 'home'
  })
}))
```

## âš™ï¸ æµ‹è¯•é…ç½®ç®¡ç†

### ç¯å¢ƒé…ç½®æ–‡ä»¶

#### 1. å‰ç«¯æµ‹è¯•é…ç½®

```typescript
// src/config/test.config.ts
export const testConfig = {
  api: {
    baseURL: 'http://localhost:3001',
    timeout: 5000
  },
  database: {
    type: 'sqlite',
    filename: ':memory:'
  },
  features: {
    enableAnalytics: false,
    enableNotifications: false
  }
}
```

#### 2. åç«¯æµ‹è¯•é…ç½®

```yaml
# src/test/resources/application-test.yml
spring:
  profiles:
    active: test

  datasource:
    url: jdbc:h2:mem:testdb;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE
    driver-class-name: org.h2.Driver
    username: sa
    password:

  jpa:
    hibernate:
      ddl-auto: create-drop
    show-sql: false

  h2:
    console:
      enabled: true
      path: /h2-console

logging:
  level:
    com.example: DEBUG
    org.springframework: WARN
    org.hibernate: WARN

# ç¦ç”¨å®‰å…¨åŠŸèƒ½ï¼ˆæµ‹è¯•æ—¶ï¼‰
security:
  enabled: false

# æµ‹è¯•ä¸“ç”¨é…ç½®
test:
  data:
    cleanup: true
  mock:
    external-services: true
```

### æ¡ä»¶åŒ–æµ‹è¯•é…ç½®

```java
// src/test/java/com/config/TestConfiguration.java
@Configuration
@Profile("test")
public class TestConfiguration {

    @Bean
    @Primary
    public DataSource dataSource() {
        // è¿”å›H2å†…å­˜æ•°æ®åº“
        return new EmbeddedDatabaseBuilder()
            .setType(EmbeddedDatabaseType.H2)
            .addScript("classpath:test-schema.sql")
            .build();
    }

    @Bean
    public TestDataFactory testDataFactory() {
        return new TestDataFactory();
    }

    @Bean
    public TestUtils testUtils(TestDataFactory testDataFactory) {
        return new TestUtils(testDataFactory);
    }
}
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [æµ‹è¯•ç­–ç•¥æ€»è§ˆ](TESTING_STRATEGY.md) - æµ‹è¯•ç­–ç•¥å’Œç›®æ ‡
- [æµ‹è¯•æœ€ä½³å®è·µ](TESTING_BEST_PRACTICES.md) - æµ‹è¯•ç¼–å†™è§„èŒƒ
- [å‰ç«¯æµ‹è¯•æŒ‡å—](../FRONTEND_TESTING_GUIDE.md) - å‰ç«¯æµ‹è¯•è¯¦ç»†è¯´æ˜
- [åç«¯æµ‹è¯•æŒ‡å—](BACKEND_TESTING_GUIDE.md) - åç«¯æµ‹è¯•è¯¦ç»†è¯´æ˜
- [æµ‹è¯•ä»£ç ç¤ºä¾‹](TESTING_EXAMPLES.md) - å®ç”¨æµ‹è¯•ä»£ç ç¤ºä¾‹
