# å‰ç«¯E2Eæµ‹è¯•è¿è¡ŒæŒ‡å—

æœ¬æ–‡æ¡£è¯¦ç»†ä»‹ç»å¦‚ä½•æœ¬åœ°è¿è¡Œã€è°ƒè¯•å’Œæ•…éšœæ’æŸ¥å‰ç«¯é¡¹ç›®çš„ç«¯åˆ°ç«¯æµ‹è¯•ã€‚

## ğŸ“‹ ç›®å½•

- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [æœ¬åœ°è¿è¡Œ](#æœ¬åœ°è¿è¡Œ)
- [CI/CDè¿è¡Œ](#cicdè¿è¡Œ)
- [è°ƒè¯•æŠ€å·§](#è°ƒè¯•æŠ€å·§)
- [æ•…éšœæ’æŸ¥](#æ•…éšœæ’æŸ¥)
- [æ€§èƒ½ä¼˜åŒ–](#æ€§èƒ½ä¼˜åŒ–)
- [æŠ¥å‘ŠæŸ¥çœ‹](#æŠ¥å‘ŠæŸ¥çœ‹)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- **Node.js**: 18.x æˆ–æ›´é«˜ç‰ˆæœ¬
- **npm**: 8.x æˆ–æ›´é«˜ç‰ˆæœ¬
- **Git**: ç”¨äºä»£ç ç®¡ç†

### å®‰è£…ä¾èµ–

```bash
# æ ¹ç›®å½•å®‰è£…æ ¹ä¾èµ–
npm install

# å®‰è£…å‰ç«¯é¡¹ç›®ä¾èµ–
cd springboot1ngh61a2/src/main/resources/front/front
npm install

# å®‰è£…ç®¡ç†ç«¯é¡¹ç›®ä¾èµ–
cd springboot1ngh61a2/src/main/resources/admin/admin
npm install

# å®‰è£…Playwrightæµè§ˆå™¨ï¼ˆé¦–æ¬¡è¿è¡Œéœ€è¦ï¼‰
cd springboot1ngh61a2/src/main/resources/front/front
npx playwright install

cd springboot1ngh61a2/src/main/resources/admin/admin
npx playwright install
```

## ğŸ  æœ¬åœ°è¿è¡Œ

### ä½¿ç”¨PowerShellè„šæœ¬ï¼ˆæ¨èï¼‰

```powershell
# è¿è¡Œæ‰€æœ‰æµ‹è¯•ï¼ˆå•å…ƒæµ‹è¯• + E2Eæµ‹è¯•ï¼‰
.\run-frontend-tests.ps1

# åªè¿è¡ŒE2Eæµ‹è¯•
.\run-frontend-tests.ps1 -Type e2e

# åªè¿è¡Œå‰ç«¯E2Eæµ‹è¯•
.\run-frontend-tests.ps1 -Type e2e -App front

# åªè¿è¡Œç®¡ç†ç«¯E2Eæµ‹è¯•
.\run-frontend-tests.ps1 -Type e2e -App admin

# æŒ‡å®šæµè§ˆå™¨è¿è¡Œ
.\run-frontend-tests.ps1 -Type e2e -Browser chromium

# è°ƒè¯•æ¨¡å¼è¿è¡Œ
.\run-frontend-tests.ps1 -Type e2e -Debug

# UIæ¨¡å¼è¿è¡Œï¼ˆå¯è§†åŒ–ç•Œé¢ï¼‰
.\run-frontend-tests.ps1 -Type e2e -UI
```

### ä½¿ç”¨npmè„šæœ¬

```bash
# æ ¹ç›®å½•è¿è¡Œæ‰€æœ‰æµ‹è¯•
npm test

# è¿è¡ŒE2Eæµ‹è¯•
npm run test:e2e

# è¿è¡Œå‰ç«¯E2Eæµ‹è¯•
npm run test:e2e:front

# è¿è¡Œç®¡ç†ç«¯E2Eæµ‹è¯•
npm run test:e2e:admin

# UIæ¨¡å¼è¿è¡Œ
npm run test:e2e:ui

# ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š
npm run aggregate:results
```

### ä½¿ç”¨Playwrightå‘½ä»¤

```bash
# å‰ç«¯é¡¹ç›®
cd springboot1ngh61a2/src/main/resources/front/front

# è¿è¡Œæ‰€æœ‰E2Eæµ‹è¯•
npx playwright test

# æŒ‡å®šæµè§ˆå™¨è¿è¡Œ
npx playwright test --project=chromium
npx playwright test --project=firefox
npx playwright test --project=webkit

# è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶
npx playwright test tests/e2e/auth.spec.ts

# è¿è¡ŒåŒ…å«å…³é”®è¯çš„æµ‹è¯•
npx playwright test -g "ç™»å½•"

# è°ƒè¯•æ¨¡å¼
npx playwright test --debug

# UIæ¨¡å¼
npx playwright test --ui

# æŸ¥çœ‹æŠ¥å‘Š
npx playwright show-report
```

## ğŸ”„ CI/CDè¿è¡Œ

### GitHub Actionsè§¦å‘æ–¹å¼

#### æ‰‹åŠ¨è§¦å‘

1. è®¿é—®GitHubä»“åº“çš„Actionsæ ‡ç­¾é¡µ
2. é€‰æ‹©"Frontend E2E Tests"å·¥ä½œæµ
3. ç‚¹å‡»"Run workflow"æŒ‰é’®
4. é€‰æ‹©è¿è¡Œå‚æ•°ï¼š
   - **Project**: all, front, admin
   - **Browser**: all, chromium, firefox, webkit
   - **Test Suite**: all, user-journey, admin-journey, integration

#### è‡ªåŠ¨è§¦å‘

- **æ¨é€**: main/master/developåˆ†æ”¯ä»£ç å˜æ›´æ—¶
- **PR**: åˆ›å»ºæˆ–æ›´æ–°Pull Requestæ—¶
- **å®šæ—¶**: æ¯å‘¨ä¸€æ—©ä¸Š8ç‚¹è¿è¡Œå®Œæ•´æµ‹è¯•

### å·¥ä½œæµé…ç½®

```yaml
# .github/workflows/frontend-e2e.yml
name: Frontend E2E Tests

on:
  workflow_dispatch:
    inputs:
      project:
        default: 'all'
      browser:
        default: 'all'
      test_suite:
        default: 'all'
  schedule:
    - cron: '0 8 * * 1'  # æ¯å‘¨ä¸€æ—©ä¸Š8ç‚¹
```

### æŸ¥çœ‹CIç»“æœ

1. è®¿é—®GitHub Actionsæ ‡ç­¾é¡µ
2. é€‰æ‹©å¯¹åº”çš„å·¥ä½œæµè¿è¡Œ
3. æŸ¥çœ‹æµ‹è¯•æ‰§è¡Œæ—¥å¿—
4. ä¸‹è½½æµ‹è¯•äº§ç‰©ï¼š
   - æµ‹è¯•æŠ¥å‘Šï¼š`e2e-results-*-*.zip`
   - æµ‹è¯•è§†é¢‘ï¼š`e2e-videos-*-*.zip`ï¼ˆå¤±è´¥æ—¶ï¼‰
   - æˆªå›¾ï¼š`e2e-screenshots-*-*.zip`ï¼ˆå¤±è´¥æ—¶ï¼‰

## ğŸ› è°ƒè¯•æŠ€å·§

### Playwright UIæ¨¡å¼

```bash
# å¯åŠ¨å¯è§†åŒ–è°ƒè¯•ç•Œé¢
cd springboot1ngh61a2/src/main/resources/front/front
npx playwright test --ui
```

åœ¨UIç•Œé¢ä¸­å¯ä»¥ï¼š
- é€‰æ‹©è¦è¿è¡Œçš„æµ‹è¯•
- æŸ¥çœ‹æµ‹è¯•æ‰§è¡Œè¿‡ç¨‹
- æ£€æŸ¥DOMçŠ¶æ€
- åˆ†æç½‘ç»œè¯·æ±‚

### ä»£ç è°ƒè¯•

```typescript
test('è°ƒè¯•æµ‹è¯•', async ({ page }) => {
  // è®¾ç½®è¾ƒæ…¢çš„æ‰§è¡Œé€Ÿåº¦
  await page.emulateMedia({ media: 'screen' })

  await page.goto('/#/login')

  // æ·»åŠ æ–­ç‚¹
  await page.pause()

  // é€æ­¥æ‰§è¡Œ
  await page.fill('input[name="username"]', 'test')
  await page.click('button[type="submit"]')

  // æ£€æŸ¥é¡µé¢çŠ¶æ€
  console.log('å½“å‰URL:', page.url())
  console.log('é¡µé¢æ ‡é¢˜:', await page.title())
})
```

### ç½‘ç»œç›‘æ§

```typescript
test('ç½‘ç»œè¯·æ±‚è°ƒè¯•', async ({ page }) => {
  // ç›‘å¬æ‰€æœ‰è¯·æ±‚
  page.on('request', request => {
    console.log('Request:', request.url(), request.method())
  })

  // ç›‘å¬æ‰€æœ‰å“åº”
  page.on('response', response => {
    console.log('Response:', response.url(), response.status())
  })

  await page.goto('/#/index/home')
})
```

### æˆªå›¾å’Œå½•å±

```typescript
test('è¯¦ç»†è°ƒè¯•', async ({ page }) => {
  // æˆªå›¾å…³é”®æ­¥éª¤
  await page.goto('/#/login')
  await page.screenshot({ path: 'debug-1-login-page.png' })

  await page.fill('input[name="username"]', 'test')
  await page.screenshot({ path: 'debug-2-filled-form.png' })

  await page.click('button[type="submit"]')
  await page.screenshot({ path: 'debug-3-after-submit.png' })
})
```

## ğŸ”§ æ•…éšœæ’æŸ¥

### å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ¡ˆ

#### 1. æµè§ˆå™¨å¯åŠ¨å¤±è´¥

**é”™è¯¯ä¿¡æ¯**: `Executable doesn't exist`

**è§£å†³æ–¹æ¡ˆ**:
```bash
# é‡æ–°å®‰è£…æµè§ˆå™¨
npx playwright install

# æˆ–å®‰è£…ç‰¹å®šæµè§ˆå™¨
npx playwright install chromium
```

#### 2. ç«¯å£å†²çª

**é”™è¯¯ä¿¡æ¯**: `Port 8082 is already in use`

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ€æ­»å ç”¨ç«¯å£çš„è¿›ç¨‹
netstat -ano | findstr :8082
taskkill /PID <PID> /F

# æˆ–ä¿®æ”¹ç«¯å£é…ç½®
echo "E2E_PORT=8083" > .env.e2e
```

#### 3. å…ƒç´ å®šä½å¤±è´¥

**é”™è¯¯ä¿¡æ¯**: `Element not found`

**è°ƒè¯•æ­¥éª¤**:
```typescript
// 1. æ£€æŸ¥å…ƒç´ æ˜¯å¦å­˜åœ¨
const element = await page.locator('.element').first()
console.log('å…ƒç´ å­˜åœ¨:', await element.isVisible())

// 2. æ‰“å°é¡µé¢HTML
console.log(await page.content())

// 3. ä½¿ç”¨æ›´å®½æ¾çš„é€‰æ‹©å™¨
await page.locator('[data-testid="element"]').waitFor()
```

#### 4. ç½‘ç»œè¶…æ—¶

**é”™è¯¯ä¿¡æ¯**: `Timeout exceeded`

**è§£å†³æ–¹æ¡ˆ**:
```typescript
// å¢åŠ è¶…æ—¶æ—¶é—´
await page.waitForSelector('.element', { timeout: 10000 })

// æˆ–æ£€æŸ¥ç½‘ç»œæ¡ä»¶
await page.waitForLoadState('networkidle', { timeout: 30000 })
```

#### 5. Mockæ•°æ®ä¸ç”Ÿæ•ˆ

**è°ƒè¯•æ­¥éª¤**:
```typescript
// ç›‘å¬å®é™…è¯·æ±‚
page.on('request', request => {
  console.log('å®é™…è¯·æ±‚:', request.url())
})

// æ£€æŸ¥Mockè®¾ç½®æ˜¯å¦åœ¨é¡µé¢æ“ä½œå‰
await mockFrontApi(page)  // å¿…é¡»åœ¨gotoä¹‹å‰
await page.goto('/#/index/home')
```

### ç¯å¢ƒé—®é¢˜æ’æŸ¥

#### æ£€æŸ¥Node.jsç‰ˆæœ¬

```bash
node --version  # åº”è¯¥ >= 18.0.0
npm --version   # åº”è¯¥ >= 8.0.0
```

#### æ£€æŸ¥ä¾èµ–å®‰è£…

```bash
# æ£€æŸ¥ä¾èµ–æ˜¯å¦æ­£ç¡®å®‰è£…
cd springboot1ngh61a2/src/main/resources/front/front
npm list playwright

# é‡æ–°å®‰è£…ä¾èµ–
rm -rf node_modules package-lock.json
npm install
```

#### æ£€æŸ¥ç½‘ç»œè¿æ¥

```bash
# æµ‹è¯•ç½‘ç»œè¿æ¥
curl -I http://127.0.0.1:8082

# æ£€æŸ¥é˜²ç«å¢™è®¾ç½®
netstat -an | findstr :8082
```

### æµ‹è¯•ç¨³å®šæ€§é—®é¢˜

#### éšæœºå¤±è´¥æ’æŸ¥

```typescript
// æ·»åŠ é‡è¯•æœºåˆ¶
test.describe.configure({ retries: 3 })

// æˆ–åœ¨æµ‹è¯•ä¸­æ·»åŠ ç¨³å®šæ€§æ£€æŸ¥
test('ç¨³å®šæµ‹è¯•', async ({ page }) => {
  await page.goto('/#/index/home')

  // ç­‰å¾…é¡µé¢ç¨³å®š
  await page.waitForLoadState('networkidle')
  await page.waitForTimeout(1000)  // é¢å¤–ç­‰å¾…

  // å¤šæ¬¡æ£€æŸ¥å…ƒç´ 
  for (let i = 0; i < 3; i++) {
    const element = await page.locator('.element').isVisible()
    if (element) break
    await page.waitForTimeout(500)
  }
})
```

#### ç«æ€æ¡ä»¶å¤„ç†

```typescript
// ä½¿ç”¨Promise.allå¤„ç†å¹¶å‘æ“ä½œ
await Promise.all([
  page.click('button'),
  page.waitForSelector('.result')
])

// æˆ–é¡ºåºæ‰§è¡Œ
await page.click('button')
await page.waitForSelector('.result')
```

## âš¡ æ€§èƒ½ä¼˜åŒ–

### è¿è¡Œé€Ÿåº¦ä¼˜åŒ–

```bash
# å¹¶è¡Œè¿è¡Œæµ‹è¯•
npx playwright test --workers=4

# åªè¿è¡Œå¤±è´¥çš„æµ‹è¯•
npx playwright test --last-failed

# è·³è¿‡æµè§ˆå™¨å®‰è£…ï¼ˆå¦‚æœå·²å®‰è£…ï¼‰
npx playwright test --headed  # ä½¿ç”¨å·²å®‰è£…çš„æµè§ˆå™¨
```

### é…ç½®ä¼˜åŒ–

```typescript
// playwright.config.ts ä¼˜åŒ–
export default defineConfig({
  // å¢åŠ å¹¶è¡Œåº¦
  workers: 4,

  // å‡å°‘è¶…æ—¶æ—¶é—´ï¼ˆå¦‚æœæµ‹è¯•ç¨³å®šï¼‰
  timeout: 20000,
  expect: {
    timeout: 3000,
  },

  // ä¼˜åŒ–æµè§ˆå™¨å¯åŠ¨
  use: {
    headless: true,
    // ç¦ç”¨ä¸å¿…è¦çš„ç‰¹æ€§
    video: 'retain-on-failure',
    screenshot: 'only-on-failure',
  },
})
```

### æµ‹è¯•åˆ†ç»„è¿è¡Œ

```bash
# åˆ†ç»„è¿è¡Œå‡å°‘èµ„æºå ç”¨
npx playwright test tests/e2e/auth.spec.ts --workers=1
npx playwright test tests/e2e/user-journey/ --workers=2
npx playwright test tests/e2e/integration/ --workers=1
```

## ğŸ“Š æŠ¥å‘ŠæŸ¥çœ‹

### Playwright HTMLæŠ¥å‘Š

```bash
# ç”Ÿæˆå¹¶æŸ¥çœ‹HTMLæŠ¥å‘Š
npx playwright show-report

# æˆ–ç›´æ¥æ‰“å¼€æ–‡ä»¶
# playwright-report/index.html
```

æŠ¥å‘ŠåŒ…å«ï¼š
- æµ‹è¯•æ‰§è¡Œæ¦‚è§ˆ
- è¯¦ç»†çš„æµ‹è¯•æ­¥éª¤
- æˆªå›¾å’Œè§†é¢‘
- é”™è¯¯è¯¦æƒ…
- æ€§èƒ½æŒ‡æ ‡

### è‡ªå®šä¹‰èšåˆæŠ¥å‘Š

```bash
# ç”Ÿæˆèšåˆæµ‹è¯•æŠ¥å‘Š
npm run aggregate:results

# æŸ¥çœ‹ç”Ÿæˆçš„æŠ¥å‘Š
# test-reports/test-report-*.html
```

èšåˆæŠ¥å‘ŠåŒ…å«ï¼š
- å¤šé¡¹ç›®æµ‹è¯•æ±‡æ€»
- é€šè¿‡ç‡ç»Ÿè®¡
- è¦†ç›–ç‡ä¿¡æ¯
- æ€§èƒ½å¯¹æ¯”

### CI/CDæŠ¥å‘Š

åœ¨GitHub Actionsä¸­ï¼š
1. è®¿é—®Actionsæ ‡ç­¾é¡µ
2. ç‚¹å‡»å·¥ä½œæµè¿è¡Œ
3. ä¸‹è½½Artifactsï¼š
   - `e2e-results-*-*.zip`: æµ‹è¯•ç»“æœ
   - `e2e-videos-*-*.zip`: å¤±è´¥è§†é¢‘
   - `e2e-screenshots-*-*.zip`: å¤±è´¥æˆªå›¾

## â“ å¸¸è§é—®é¢˜

### Q: æµ‹è¯•è¿è¡Œå¤ªæ…¢æ€ä¹ˆåŠï¼Ÿ

A:
1. å¢åŠ `--workers`å‚æ•°
2. ä½¿ç”¨`--grep`åªè¿è¡Œéœ€è¦çš„æµ‹è¯•
3. ä¼˜åŒ–é¡µé¢ç­‰å¾…é€»è¾‘
4. ä½¿ç”¨æ›´å¿«çš„å®šä½å™¨

### Q: å¦‚ä½•å¤„ç†ä¸ç¨³å®šçš„æµ‹è¯•ï¼Ÿ

A:
1. æ·»åŠ é€‚å½“çš„ç­‰å¾…æ—¶é—´
2. ä½¿ç”¨æ›´ç¨³å®šçš„å®šä½å™¨
3. å¤„ç†å¼‚æ­¥æ“ä½œ
4. æ·»åŠ é‡è¯•æœºåˆ¶

### Q: å¦‚ä½•è°ƒè¯•å®šä½å™¨é—®é¢˜ï¼Ÿ

A:
1. ä½¿ç”¨`page.pause()`æ·»åŠ æ–­ç‚¹
2. åœ¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·ä¸­æ£€æŸ¥å…ƒç´ 
3. ä½¿ç”¨`page.locator()`çš„`nth()`æ–¹æ³•
4. æ·»åŠ `data-testid`å±æ€§

### Q: å¦‚ä½•å¤„ç†è·¨åŸŸé—®é¢˜ï¼Ÿ

A:
```typescript
// åœ¨playwright.config.tsä¸­é…ç½®
export default defineConfig({
  use: {
    bypassCSP: true,  // ç»•è¿‡å†…å®¹å®‰å…¨ç­–ç•¥
    ignoreHTTPSErrors: true,  // å¿½ç•¥HTTPSé”™è¯¯
  },
})
```

### Q: å¦‚ä½•å¤„ç†åŠ¨æ€å†…å®¹ï¼Ÿ

A:
```typescript
// ç­‰å¾…åŠ¨æ€å†…å®¹åŠ è½½
await page.waitForFunction(() => {
  return document.querySelectorAll('.dynamic-item').length > 0
})

// æˆ–ä½¿ç”¨æ›´ç¨³å®šçš„é€‰æ‹©å™¨
await page.locator('[data-testid^="item-"]').first().waitFor()
```

## ğŸ“ è·å–å¸®åŠ©

### è°ƒè¯•å‘½ä»¤æ±‡æ€»

```bash
# è¯¦ç»†æ—¥å¿—
DEBUG=pw:api npx playwright test

# æ…¢é€Ÿæ‰§è¡Œ
npx playwright test --headed --slowMo=1000

# è®°å½•è§†é¢‘
npx playwright test --video=retain-on-failure

# ç”Ÿæˆtrace
npx playwright test --trace=on
```

### ç¤¾åŒºèµ„æº

- [Playwright GitHub Issues](https://github.com/microsoft/playwright/issues)
- [Playwright Discord](https://discord.gg/playwright)
- [æµ‹è¯•è‡ªåŠ¨åŒ–æœ€ä½³å®è·µ](https://playwright.dev/docs/best-practices)

---

**æœ€åæ›´æ–°**: 2025-11-16
