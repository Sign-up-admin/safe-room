---
title: E2E TESTING GUIDE
version: v1.0.0
last_updated: 2025-11-16
status: active
category: technical
---
# å‰ç«¯E2Eæµ‹è¯•ç¼–å†™æŒ‡å—

æœ¬æ–‡æ¡£è¯¦ç»†ä»‹ç»å¦‚ä½•ç¼–å†™ã€è¿è¡Œå’Œç®¡ç†å‰ç«¯é¡¹ç›®çš„ç«¯åˆ°ç«¯æµ‹è¯•ã€‚

## ğŸ“‹ ç›®å½•

- [æµ‹è¯•æ¡†æ¶æ¦‚è¿°](#æµ‹è¯•æ¡†æ¶æ¦‚è¿°)
- [é¡¹ç›®ç»“æ„](#é¡¹ç›®ç»“æ„)
- [ç¼–å†™E2Eæµ‹è¯•](#ç¼–å†™e2eæµ‹è¯•)
- [é¡µé¢å¯¹è±¡æ¨¡å¼](#é¡µé¢å¯¹è±¡æ¨¡å¼)
- [Mockæ•°æ®ä½¿ç”¨](#mockæ•°æ®ä½¿ç”¨)
- [æµ‹è¯•å·¥å…·åº“](#æµ‹è¯•å·¥å…·åº“)
- [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)
- [è°ƒè¯•æŠ€å·§](#è°ƒè¯•æŠ€å·§)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

## ğŸ§ª æµ‹è¯•æ¡†æ¶æ¦‚è¿°

### æŠ€æœ¯æ ˆ

- **æµ‹è¯•æ¡†æ¶**: Playwright 1.56+
- **æµ‹è¯•è¿è¡Œå™¨**: Playwright Test Runner
- **æ–­è¨€åº“**: Playwrightå†…ç½®æ–­è¨€
- **æµè§ˆå™¨æ”¯æŒ**: Chromium, Firefox, WebKit
- **è¯­è¨€**: TypeScript

### æ”¯æŒçš„é¡¹ç›®

- **Fronté¡¹ç›®**: ç”¨æˆ·ç«¯åº”ç”¨ (ç«¯å£: 8082)
- **Adminé¡¹ç›®**: ç®¡ç†ç«¯åº”ç”¨ (ç«¯å£: 8081)

## ğŸ—ï¸ é¡¹ç›®ç»“æ„

```
springboot1ngh61a2/src/main/resources/
â”œâ”€â”€ front/front/
â”‚   â”œâ”€â”€ tests/
â”‚   â”‚   â”œâ”€â”€ e2e/
â”‚   â”‚   â”‚   â”œâ”€â”€ user-journey/          # ç”¨æˆ·æ—…ç¨‹æµ‹è¯•
â”‚   â”‚   â”‚   â”œâ”€â”€ integration/           # é›†æˆæµ‹è¯•
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.spec.ts          # è®¤è¯æµ‹è¯•
â”‚   â”‚   â”‚   â””â”€â”€ pages.spec.ts         # é¡µé¢æµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”‚   â”œâ”€â”€ test-helpers.ts       # æµ‹è¯•å·¥å…·åº“
â”‚   â”‚   â”‚   â”œâ”€â”€ mock-data.ts          # Mockæ•°æ®
â”‚   â”‚   â”‚   â”œâ”€â”€ shared-helpers.ts     # å…±äº«å·¥å…·
â”‚   â”‚   â”‚   â””â”€â”€ page-objects/         # é¡µé¢å¯¹è±¡
â”‚   â”‚   â””â”€â”€ fixtures/                 # æµ‹è¯•å›ºä»¶
â”‚   â”œâ”€â”€ playwright.config.ts          # Playwrighté…ç½®
â”‚   â””â”€â”€ vitest.config.ts             # å•å…ƒæµ‹è¯•é…ç½®
â””â”€â”€ admin/admin/
    â””â”€â”€ tests/
        â”œâ”€â”€ e2e/
        â”‚   â””â”€â”€ admin-journey/        # ç®¡ç†æµç¨‹æµ‹è¯•
        â””â”€â”€ utils/
            â”œâ”€â”€ test-helpers.ts       # Adminæµ‹è¯•å·¥å…·
            â”œâ”€â”€ mock-data.ts          # Admin Mockæ•°æ®
            â””â”€â”€ page-objects/         # Adminé¡µé¢å¯¹è±¡
```

## âœï¸ ç¼–å†™E2Eæµ‹è¯•

### åŸºæœ¬æµ‹è¯•ç»“æ„

```typescript
import { test, expect } from '@playwright/test'
import {
  setupCompleteFrontMock,
  mockFrontApi
} from '../utils/test-helpers'

test.describe('åŠŸèƒ½æ¨¡å—åç§°', () => {
  test.beforeEach(async ({ page }) => {
    // è®¾ç½®æµ‹è¯•ç¯å¢ƒ
    await setupCompleteFrontMock(page)
  })

  test('æµ‹è¯•åœºæ™¯æè¿°', async ({ page }) => {
    // 1. å‡†å¤‡æµ‹è¯•æ•°æ®
    // 2. æ‰§è¡Œç”¨æˆ·æ“ä½œ
    // 3. éªŒè¯ç»“æœ
  })
})
```

### æµ‹è¯•ç”Ÿå‘½å‘¨æœŸ

```typescript
test.describe('æµ‹è¯•å¥—ä»¶', () => {
  // å¥—ä»¶çº§åˆ«è®¾ç½® - æ‰€æœ‰æµ‹è¯•å‰æ‰§è¡Œä¸€æ¬¡
  test.beforeAll(async () => {
    // å…¨å±€åˆå§‹åŒ–
  })

  // æ¯ä¸ªæµ‹è¯•å‰æ‰§è¡Œ
  test.beforeEach(async ({ page }) => {
    // æµ‹è¯•ç¯å¢ƒå‡†å¤‡
    await setupCompleteFrontMock(page)
  })

  // æ¯ä¸ªæµ‹è¯•åæ‰§è¡Œ
  test.afterEach(async ({ page }) => {
    // æ¸…ç†å·¥ä½œ
  })

  // å¥—ä»¶çº§åˆ«æ¸…ç† - æ‰€æœ‰æµ‹è¯•åæ‰§è¡Œä¸€æ¬¡
  test.afterAll(async () => {
    // å…¨å±€æ¸…ç†
  })
})
```

### æ–­è¨€ä½¿ç”¨

```typescript
// é¡µé¢URLæ–­è¨€
await expect(page).toHaveURL(/.*\/home/)

// å…ƒç´ å¯è§æ€§
await expect(page.locator('.success-message')).toBeVisible()

// æ–‡æœ¬å†…å®¹
await expect(page.locator('.title')).toContainText('æ¬¢è¿ä½¿ç”¨')

// å…ƒç´ å±æ€§
await expect(page.locator('input[name="username"]')).toHaveValue('testuser')

// å…ƒç´ æ•°é‡
await expect(page.locator('.card')).toHaveCount(3)

// è¡¨å•éªŒè¯
await expect(page.locator('.error-message')).toHaveText('è¯·è¾“å…¥ç”¨æˆ·å')
```

## ğŸ“„ é¡µé¢å¯¹è±¡æ¨¡å¼

### é¡µé¢å¯¹è±¡ç±»ç»“æ„

```typescript
import { Page } from '@playwright/test'
import { BasePage } from './base-page'

export class LoginPage extends BasePage {
  constructor(page: Page, baseUrl?: string) {
    super(page, baseUrl)
  }

  // é¡µé¢å¯¼èˆª
  async goto(): Promise<void> {
    await this.page.goto(`${this.baseUrl}/#/login`)
    await this.waitForPageLoad()
  }

  // é¡µé¢æ“ä½œæ–¹æ³•
  async login(username: string, password: string): Promise<void> {
    await this.fillInput('input[name="username"]', username)
    await this.fillInput('input[name="password"]', password)
    await this.clickButton('ç™»å½•')
    await this.page.waitForURL('**/#/index/home**')
  }

  // é¡µé¢çŠ¶æ€æ£€æŸ¥
  async getErrorMessage(): Promise<string> {
    return await this.getElementText('.error-message')
  }

  // ä¸šåŠ¡é€»è¾‘æ–¹æ³•
  async loginWithValidCredentials(): Promise<void> {
    await this.login('testuser', 'password123')
  }
}
```

### ä½¿ç”¨é¡µé¢å¯¹è±¡

```typescript
import { test, expect } from '@playwright/test'
import { LoginPage, DashboardPage } from '../utils/page-objects'

test('ä½¿ç”¨é¡µé¢å¯¹è±¡è¿›è¡Œç™»å½•æµ‹è¯•', async ({ page }) => {
  const loginPage = new LoginPage(page)
  const dashboardPage = new DashboardPage(page)

  // ä½¿ç”¨é¡µé¢å¯¹è±¡æ–¹æ³•
  await loginPage.goto()
  await loginPage.login('admin', 'password')

  // éªŒè¯ç»“æœ
  await expect(page).toHaveURL(/.*\/dashboard/)
  await expect(dashboardPage.getWelcomeMessage()).toContain('æ¬¢è¿')
})
```

## ğŸ­ Mockæ•°æ®ä½¿ç”¨

### Fronté¡¹ç›®Mockæ•°æ®

```typescript
import { test, expect } from '@playwright/test'
import { mockFrontApi, seedFrontSession } from '../utils/test-helpers'

test('ä½¿ç”¨Mockæ•°æ®æµ‹è¯•', async ({ page }) => {
  // åˆå§‹åŒ–ç”¨æˆ·ä¼šè¯
  await seedFrontSession(page, {
    frontToken: 'test-token',
    UserTableName: 'yonghu'
  })

  // Mock APIå“åº”
  await mockFrontApi(page, {
    // è‡ªå®šä¹‰Mockæ•°æ®
    users: [
      { yonghuming: 'æµ‹è¯•ç”¨æˆ·', shouji: '13800138000' }
    ],
    courses: [
      { kechengmingcheng: 'æµ‹è¯•è¯¾ç¨‹', jiage: '100' }
    ]
  })

  // æ‰§è¡Œæµ‹è¯•
  await page.goto('/#/index/home')
  await expect(page.locator('text=æµ‹è¯•ç”¨æˆ·')).toBeVisible()
})
```

### Adminé¡¹ç›®Mockæ•°æ®

```typescript
import { test, expect } from '@playwright/test'
import { mockAdminApi, loginAsAdmin } from '../utils/test-helpers'

test('ç®¡ç†å‘˜åŠŸèƒ½æµ‹è¯•', async ({ page }) => {
  // è®¾ç½®Admin API Mock
  await mockAdminApi(page)

  // ç®¡ç†å‘˜ç™»å½•
  await loginAsAdmin(page)

  // éªŒè¯ç®¡ç†å‘˜ç•Œé¢
  await expect(page.locator('.admin-panel')).toBeVisible()
})
```

### æ”¯ä»˜å’Œç¬¬ä¸‰æ–¹æœåŠ¡Mock

```typescript
import { mockPaymentFlow, mockThirdPartyLogin } from '../utils/test-helpers'

test('æ”¯ä»˜æµç¨‹æµ‹è¯•', async ({ page }) => {
  // Mockæ”¯ä»˜æµç¨‹
  await mockPaymentFlow(page)

  // æ‰§è¡Œæ”¯ä»˜æ“ä½œ
  await page.click('button:has-text("æ”¯ä»˜å®æ”¯ä»˜")')

  // éªŒè¯æ”¯ä»˜æˆåŠŸ
  await page.waitForSelector('text=æ”¯ä»˜æˆåŠŸ')
})
```

## ğŸ› ï¸ æµ‹è¯•å·¥å…·åº“

### å…±äº«å·¥å…·ä½¿ç”¨

```typescript
import {
  waitFor,
  waitForPage,
  takeScreenshot,
  measurePerformance,
  logStep,
  assertElement
} from '../utils/shared-helpers'

test('ä½¿ç”¨å…±äº«å·¥å…·', async ({ page }) => {
  logStep('å¼€å§‹æµ‹è¯•æ­¥éª¤')

  await page.goto('/#/index/home')
  await waitForPage(page)

  // æˆªå›¾è®°å½•
  await takeScreenshot(page, 'homepage_loaded')

  // æ€§èƒ½æµ‹é‡
  const perfMetrics = await measurePerformance(page)
  console.log('é¡µé¢åŠ è½½æ—¶é—´:', perfMetrics.domContentLoaded)

  // æ–­è¨€å·¥å…·
  await assertElement(page, '.main-content')

  logStep('æµ‹è¯•æ­¥éª¤å®Œæˆ')
})
```

### ç½‘ç»œæ‹¦æˆªå’Œç›‘æ§

```typescript
import { NetworkUtils } from '../utils/shared-helpers'

test('ç½‘ç»œè¯·æ±‚ç›‘æ§', async ({ page }) => {
  // æ‹¦æˆªAPIè¯·æ±‚
  await NetworkUtils.interceptRequests(page, '**/api/**')

  // æ‰§è¡Œæ“ä½œ
  await page.click('button:has-text("åŠ è½½æ•°æ®")')

  // æ£€æŸ¥æ‹¦æˆªçš„è¯·æ±‚
  const requests = NetworkUtils.getInterceptedRequests('**/api/**')
  expect(requests.length).toBeGreaterThan(0)

  // éªŒè¯è¯·æ±‚å†…å®¹
  const firstRequest = requests[0]
  expect(firstRequest.method).toBe('GET')
})
```

### æµ‹è¯•æ•°æ®ç”Ÿæˆ

```typescript
import { TestDataUtils } from '../utils/shared-helpers'

test('åŠ¨æ€æ•°æ®ç”Ÿæˆ', async ({ page }) => {
  // ç”Ÿæˆæµ‹è¯•ç”¨æˆ·
  const testUser = TestDataUtils.generateRandomData('user')
  const testCourse = TestDataUtils.generateRandomData('course')

  // ä½¿ç”¨ç”Ÿæˆçš„æµ‹è¯•æ•°æ®
  await page.fill('input[name="username"]', testUser.yonghuming)
  await page.fill('input[name="phone"]', testUser.shouji)

  console.log('æµ‹è¯•æ•°æ®:', { testUser, testCourse })
})
```

## ğŸ’¡ æœ€ä½³å®è·µ

### æµ‹è¯•å‘½åè§„èŒƒ

```typescript
// âœ… å¥½çš„å‘½å
test('ç”¨æˆ·æˆåŠŸç™»å½•ååº”è¯¥è·³è½¬åˆ°é¦–é¡µ')
test('æäº¤æ— æ•ˆè¡¨å•æ—¶åº”è¯¥æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯')
test('ç®¡ç†å‘˜å¯ä»¥åˆ›å»ºæ–°è¯¾ç¨‹')

// âŒ ä¸å¥½çš„å‘½å
test('test login')
test('check form')
test('admin create')
```

### æµ‹è¯•ç»„ç»‡ç»“æ„

```typescript
test.describe('ç”¨æˆ·ç®¡ç†', () => {
  test.describe('ç”¨æˆ·æ³¨å†Œ', () => {
    test('æˆåŠŸæ³¨å†Œæ–°ç”¨æˆ·')
    test('æ³¨å†Œæ—¶éªŒè¯å¿…å¡«å­—æ®µ')
    test('æ³¨å†Œå¤±è´¥æ—¶æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯')
  })

  test.describe('ç”¨æˆ·ç™»å½•', () => {
    test('ä½¿ç”¨æœ‰æ•ˆå‡­æ®ç™»å½•')
    test('ä½¿ç”¨æ— æ•ˆå‡­æ®ç™»å½•å¤±è´¥')
    test('å¿˜è®°å¯†ç åŠŸèƒ½')
  })
})
```

### æ•°æ®æ¸…ç†

```typescript
test('åˆ›å»ºç”¨æˆ·åæ¸…ç†æ•°æ®', async ({ page }) => {
  // åˆ›å»ºæµ‹è¯•æ•°æ®
  const testUser = TestDataUtils.generateRandomData('user')

  // æ‰§è¡Œæµ‹è¯•
  await createUser(page, testUser)

  // éªŒè¯ç»“æœ
  await expect(page.locator(`text=${testUser.yonghuming}`)).toBeVisible()

  // æ¸…ç†æµ‹è¯•æ•°æ®
  await cleanupTestData(page, 'users', testUser.yonghuming)
})
```

### é”™è¯¯å¤„ç†

```typescript
test('ç½‘ç»œé”™è¯¯å¤„ç†', async ({ page }) => {
  // æ¨¡æ‹Ÿç½‘ç»œé”™è¯¯
  await NetworkUtils.mockNetworkError(page, '**/api/**', 500)

  // æ‰§è¡Œéœ€è¦ç½‘ç»œçš„æ“ä½œ
  await page.click('button:has-text("ä¿å­˜")')

  // éªŒè¯é”™è¯¯å¤„ç†
  await expect(page.locator('text=ç½‘ç»œé”™è¯¯')).toBeVisible()
  await expect(page.locator('text=è¯·é‡è¯•')).toBeVisible()
})
```

## ğŸ› è°ƒè¯•æŠ€å·§

### ä½¿ç”¨Playwright UIæ¨¡å¼

```bash
# å¯åŠ¨UIæ¨¡å¼è¿›è¡Œè°ƒè¯•
npm run test:e2e:ui

# æˆ–è€…æŒ‡å®šé¡¹ç›®
npx playwright test --ui --project=chromium
```

### æ·»åŠ è°ƒè¯•æ–­ç‚¹

```typescript
test('è°ƒè¯•æµ‹è¯•', async ({ page }) => {
  await page.goto('/#/login')

  // æ·»åŠ æ–­ç‚¹
  await page.pause()

  // ç»§ç»­æ‰§è¡Œ
  await page.fill('input[name="username"]', 'test')
  await page.click('button[type="submit"]')
})
```

### æˆªå›¾å’Œè§†é¢‘å½•åˆ¶

```typescript
test('æ•…éšœæ’æŸ¥æµ‹è¯•', async ({ page }) => {
  try {
    await page.goto('/#/index/home')
    await page.click('.non-existent-element')
  } catch (error) {
    // è‡ªåŠ¨æˆªå›¾
    await page.screenshot({ path: 'error-screenshot.png' })

    // è®°å½•é¡µé¢çŠ¶æ€
    console.log('é¡µé¢URL:', page.url())
    console.log('é¡µé¢æ ‡é¢˜:', await page.title())

    throw error
  }
})
```

### æ§åˆ¶æ‰§è¡Œé€Ÿåº¦

```typescript
// åœ¨playwright.config.tsä¸­é…ç½®
export default defineConfig({
  use: {
    // å‡æ…¢æ‰§è¡Œé€Ÿåº¦ä¾¿äºè§‚å¯Ÿ
    actionTimeout: 1000,
    navigationTimeout: 30000,
  },
  // æˆ–åœ¨æµ‹è¯•ä¸­æ·»åŠ å»¶è¿Ÿ
  // await page.waitForTimeout(1000)
})
```

## â“ å¸¸è§é—®é¢˜

### Q: æµ‹è¯•è¿è¡Œå¤ªæ…¢æ€ä¹ˆåŠï¼Ÿ

A: ä¼˜åŒ–å»ºè®®ï¼š
1. ä½¿ç”¨å¹¶è¡Œæ‰§è¡Œï¼š`--workers=4`
2. åªè¿è¡Œéœ€è¦çš„æµ‹è¯•ï¼š`--grep "å…³é”®è¯"`
3. å‡å°‘ä¸å¿…è¦çš„ç­‰å¾…
4. ä½¿ç”¨æ›´å¿«çš„å®šä½å™¨

### Q: å…ƒç´ å®šä½å¤±è´¥æ€ä¹ˆåŠï¼Ÿ

A: å®šä½ç­–ç•¥ï¼š
1. ä¼˜å…ˆä½¿ç”¨è¯­ä¹‰åŒ–çš„é€‰æ‹©å™¨
2. ä½¿ç”¨data-testidå±æ€§
3. é¿å…ä¾èµ–CSSç±»å
4. ä½¿ç”¨æ–‡æœ¬å†…å®¹å®šä½

### Q: å¦‚ä½•å¤„ç†å¼‚æ­¥æ“ä½œï¼Ÿ

A: å¤„ç†æ–¹æ³•ï¼š
```typescript
// ç­‰å¾…ç½‘ç»œç©ºé—²
await page.waitForLoadState('networkidle')

// ç­‰å¾…ç‰¹å®šå…ƒç´ 
await page.waitForSelector('.loading', { state: 'hidden' })

// ä½¿ç”¨Promise
await Promise.all([
  page.click('button'),
  page.waitForSelector('.result')
])
```

### Q: Mockæ•°æ®ä¸ç”Ÿæ•ˆæ€ä¹ˆåŠï¼Ÿ

A: æ£€æŸ¥æ­¥éª¤ï¼š
1. ç¡®è®¤Mockå‡½æ•°åœ¨é¡µé¢æ“ä½œå‰è°ƒç”¨
2. æ£€æŸ¥URLæ¨¡å¼åŒ¹é…
3. éªŒè¯Mockæ•°æ®æ ¼å¼
4. ä½¿ç”¨`page.on('request')`ç›‘å¬å®é™…è¯·æ±‚

### Q: å¦‚ä½•å¤„ç†ç™»å½•çŠ¶æ€ï¼Ÿ

A: çŠ¶æ€ç®¡ç†ï¼š
```typescript
// ä½¿ç”¨storageState
export default defineConfig({
  use: {
    storageState: 'tests/.auth/user.json'
  }
})

// æˆ–åœ¨æµ‹è¯•ä¸­è®¾ç½®
await page.addInitScript(() => {
  localStorage.setItem('token', 'test-token')
})
```

## ğŸ“š ç›¸å…³èµ„æº

- [Playwrightå®˜æ–¹æ–‡æ¡£](https://playwright.dev/)
- [æµ‹è¯•æœ€ä½³å®è·µ](https://playwright.dev/docs/best-practices)
- [APIå‚è€ƒ](https://playwright.dev/docs/api/class-playwright)

## ğŸ¯ æµ‹è¯•ç­–ç•¥å»ºè®®

1. **æµ‹è¯•é‡‘å­—å¡”**: å•å…ƒæµ‹è¯• > é›†æˆæµ‹è¯• > E2Eæµ‹è¯•
2. **æµ‹è¯•èŒƒå›´**: æ ¸å¿ƒç”¨æˆ·æ—…ç¨‹ > è¾¹ç•Œæƒ…å†µ > é”™è¯¯åœºæ™¯
3. **æµ‹è¯•é¢‘ç‡**: æäº¤å‰ > åˆå¹¶å‰ > å‘å¸ƒå‰
4. **ç»´æŠ¤åŸåˆ™**: ä¿æŒæµ‹è¯•ç®€æ´ã€ç‹¬ç«‹ã€å¯ç»´æŠ¤

---

**æœ€åæ›´æ–°**: 2025-11-16
